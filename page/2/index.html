<!DOCTYPE html>


<html lang="zh-CN">


<head>
  <meta charset="utf-8" />
    
  <meta name="description" content="摇旗呐喊的热情,携光阴渐远去,人世间悲喜烂剧,昼夜轮播不停,纷飞的滥情男女,情仇爱恨别离,一代人终将老去，但总有人正年轻" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Nero 的个人博客
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

  

</head>

</html>

<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/back4.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Nero 的个人博客</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
        <img
          src="/images/logo.png"
          class="cover-logo"
          alt="Nero 的个人博客"
        />
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['摇旗呐喊的热情,携光阴渐远去,', '人世间悲喜烂剧,昼夜轮播不停,', '纷飞的滥情男女, 情仇爱恨别离,一代人终将老去，但总有人正年轻'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  <article class="articles">
    
    
    
    
    <article
  id="post-prometheus-operator/Documentation/exposing-metrics"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/Documentation/exposing-metrics/" class="article-date">
  <time datetime="2020-12-12T13:30:47.181Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <br>
<div class="alert alert-info" role="alert">
    <i class="fa fa-exclamation-triangle"></i><b> Note:</b> Starting with v0.12.0, Prometheus Operator requires use of Kubernetes v1.7.x and up.
</div>

<h1 id="Exposing-Metrics"><a href="#Exposing-Metrics" class="headerlink" title="Exposing Metrics"></a>Exposing Metrics</h1><p>There are a number of <a target="_blank" rel="noopener" href="https://prometheus.io/docs/instrumenting/exporters/#directly-instrumented-software">applications</a> that are natively instrumented with Prometheus metrics. Those applications simply expose the metrics through an HTTP server.</p>
<p>The Prometheus developers and the community are maintaining <a target="_blank" rel="noopener" href="https://prometheus.io/docs/instrumenting/clientlibs/#client-libraries">client libraries</a> for various languages. If you want to monitor your own applications and instrument them natively, chances are there is already a client library for your language.</p>
<p>Not all software is natively instrumented with Prometheus metrics, but still record metrics in some other form. For these kinds of applications there are so called <a target="_blank" rel="noopener" href="https://prometheus.io/docs/instrumenting/exporters/#third-party-exporters">exporters</a>.</p>
<p>Exporters can generally be divided into two categories:</p>
<ul>
<li><p>Instance exporters: These expose metrics about a single instance of an application. For example the HTTP requests that a single HTTP server has exporters served. These exporters are deployed as a <a target="_blank" rel="noopener" href="http://blog.kubernetes.io/2015/06/the-distributed-system-toolkit-patterns.html">side-car</a> container in the same pod as the actual instance of the respective application.  A real life example is the <a target="_blank" rel="noopener" href="https://github.com/kubernetes/dns/blob/master/docs/sidecar/README.md"><code>dnsmasq</code> metrics sidecar</a>, which converts the proprietary metrics format communicated over the DNS protocol by <code>dnsmasq</code> to the Prometheus exposition format and exposes it on an HTTP server.</p>
</li>
<li><p>Cluster-state exporters: These expose metrics about an entire system. For example these could be the number of 3D objects in a game, or metrics about a Kubernetes deployment. These exporters are typically deployed as a normal Kubernetes deployment, but can vary depending on the nature of the particular exporter. A real life example of this is the <a target="_blank" rel="noopener" href="https://github.com/kubernetes/kube-state-metrics"><code>kube-state-metrics</code></a> exporter, which exposes metrics about the cluster state of a Kubernetes cluster.</p>
</li>
</ul>
<p>Lastly in some cases it is not a viable option to expose metrics via an HTTP server. For example a <code>CronJob</code> may only run for a few seconds - not long enough for Prometheus to be able to scrape the HTTP endpoint. The Pushgateway was developed to be able to collect metrics for that kind of a scenario. If possible it is highly recommended not to use the Pushgateway. Read more about when to use the Pushgateway and alternative strategies here: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/practices/pushing/#should-i-be-using-the-pushgateway">https://prometheus.io/docs/practices/pushing/#should-i-be-using-the-pushgateway</a>.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/Documentation/design"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/Documentation/design/" class="article-date">
  <time datetime="2020-12-12T13:30:47.174Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <br>
<div class="alert alert-info" role="alert">
    <i class="fa fa-exclamation-triangle"></i><b> Note:</b> Starting with v0.12.0, Prometheus Operator requires use of Kubernetes v1.7.x and up.
</div>

<h1 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h1><p>This document describes the design and interaction between the custom resource definitions that the Prometheus Operator introduces.</p>
<p>The custom resources that the Prometheus Operator introduces are:</p>
<ul>
<li><code>Prometheus</code></li>
<li><code>ServiceMonitor</code></li>
<li><code>PodMonitor</code> </li>
<li><code>Alertmanager</code></li>
<li><code>PrometheusRule</code></li>
</ul>
<h2 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h2><p>The <code>Prometheus</code> custom resource definition (CRD) declaratively defines a desired Prometheus setup to run in a Kubernetes cluster. It provides options to configure replication, persistent storage, and Alertmanagers to which the deployed Prometheus instances send alerts to.</p>
<p>For each <code>Prometheus</code> resource, the Operator deploys a properly configured <code>StatefulSet</code> in the same namespace. The Prometheus <code>Pod</code>s are configured to mount a <code>Secret</code> called <code>&lt;prometheus-name&gt;</code> containing the configuration for Prometheus.</p>
<p>The CRD specifies which <code>ServiceMonitor</code>s should be covered by the deployed Prometheus instances based on label selection. The Operator then generates a configuration based on the included <code>ServiceMonitor</code>s and updates it in the <code>Secret</code> containing the configuration. It continuously does so for all changes that are made to <code>ServiceMonitor</code>s or the <code>Prometheus</code> resource itself.</p>
<p>If no selection of <code>ServiceMonitor</code>s is provided, the Operator leaves management of the <code>Secret</code> to the user, which allows to provide custom configurations while still benefiting from the Operator’s capabilities of managing Prometheus setups.</p>
<h2 id="ServiceMonitor"><a href="#ServiceMonitor" class="headerlink" title="ServiceMonitor"></a>ServiceMonitor</h2><p>The <code>ServiceMonitor</code> custom resource definition (CRD) allows to declaratively define how a dynamic set of services should be monitored. Which services are selected to be monitored with the desired configuration is defined using label selections. This allows an organization to introduce conventions around how metrics are exposed, and then following these conventions new services are automatically discovered, without the need to reconfigure the system.</p>
<p>For Prometheus to monitor any application within Kubernetes an <code>Endpoints</code> object needs to exist. <code>Endpoints</code> objects are essentially lists of IP addresses. Typically an <code>Endpoints</code> object is populated by a <code>Service</code> object. A <code>Service</code> object discovers <code>Pod</code>s by a label selector and adds those to the <code>Endpoints</code> object.</p>
<p>A <code>Service</code> may expose one or more service ports, which are backed by a list of multiple endpoints that point to a <code>Pod</code> in the common case. This is reflected in the respective <code>Endpoints</code> object as well.</p>
<p>The <code>ServiceMonitor</code> object introduced by the Prometheus Operator in turn discovers those <code>Endpoints</code> objects and configures Prometheus to monitor those <code>Pod</code>s.</p>
<p>The <code>endpoints</code> section of the <code>ServiceMonitorSpec</code>, is used to configure which ports of these <code>Endpoints</code> are going to be scraped for metrics, and with which parameters. For advanced use cases one may want to monitor ports of backing <code>Pod</code>s, which are not directly part of the service endpoints. Therefore when specifying an endpoint in the <code>endpoints</code> section, they are strictly used.</p>
<blockquote>
<p>Note: <code>endpoints</code> (lowercase) is the field in the <code>ServiceMonitor</code> CRD, while <code>Endpoints</code> (capitalized) is the Kubernetes object kind.</p>
</blockquote>
<p>Both <code>ServiceMonitors</code> as well as discovered targets may come from any namespace. This is important to allow cross-namespace monitoring use cases, e.g. for meta-monitoring. Using the <code>ServiceMonitorNamespaceSelector</code> of the <code>PrometheusSpec</code>, one can restrict the namespaces <code>ServiceMonitor</code>s are selected from by the respective Prometheus server. Using the <code>namespaceSelector</code> of the <code>ServiceMonitorSpec</code>, one can restrict the namespaces the <code>Endpoints</code> objects are allowed to be discovered from.<br>To discover targets in all namespaces the <code>namespaceSelector</code> has to be empty:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">namespaceSelector:</span></span><br><span class="line">    <span class="attr">any:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="PodMonitor"><a href="#PodMonitor" class="headerlink" title="PodMonitor"></a>PodMonitor</h2><p>The <code>PodMonitor</code> custom resource definition (CRD) allows to declaratively define how a dynamic set of pods should be monitored.<br>Which pods are selected to be monitored with the desired configuration is defined using label selections.<br>This allows an organization to introduce conventions around how metrics are exposed, and then following these conventions new pods are automatically discovered, without the need to reconfigure the system.</p>
<p>A <code>Pod</code> is a collection of one or more containers which can expose Prometheus metrics on a number of ports.</p>
<p>The <code>PodMonitor</code> object introduced by the Prometheus Operator discovers these pods and generates the relevant configuration for the Prometheus server in order to monitor them. </p>
<p>The <code>PodMetricsEndpoints</code> section of the <code>PodMonitorSpec</code>, is used to configure which ports of a pod are going to be scraped for metrics, and with which parameters.</p>
<p>Both <code>PodMonitors</code> as well as discovered targets may come from any namespace. This is important to allow cross-namespace monitoring use cases, e.g. for meta-monitoring.<br>Using the <code>namespaceSelector</code> of the <code>PodMonitorSpec</code>, one can restrict the namespaces the <code>Pods</code> are allowed to be discovered from.<br>To discover targets in all namespaces the <code>namespaceSelector</code> has to be empty:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">namespaceSelector:</span></span><br><span class="line">    <span class="attr">any:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="Alertmanager"><a href="#Alertmanager" class="headerlink" title="Alertmanager"></a>Alertmanager</h2><p>The <code>Alertmanager</code> custom resource definition (CRD) declaratively defines a desired Alertmanager setup to run in a Kubernetes cluster. It provides options to configure replication and persistent storage.</p>
<p>For each <code>Alertmanager</code> resource, the Operator deploys a properly configured <code>StatefulSet</code> in the same namespace. The Alertmanager pods are configured to include a <code>Secret</code> called <code>&lt;alertmanager-name&gt;</code> which holds the used configuration file in the key <code>alertmanager.yaml</code>.</p>
<p>When there are two or more configured replicas the operator runs the Alertmanager instances in high availability mode.</p>
<h2 id="PrometheusRule"><a href="#PrometheusRule" class="headerlink" title="PrometheusRule"></a>PrometheusRule</h2><p>The <code>PrometheusRule</code> CRD declaratively defines a desired Prometheus rule to be consumed by one or more Prometheus instances. </p>
<p>Alerts and recording rules can be saved and applied as YAML files, and dynamically loaded without requiring any restart.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/Documentation/custom-configuration"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/Documentation/custom-configuration/" class="article-date">
  <time datetime="2020-12-12T13:30:47.160Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <br>
<div class="alert alert-info" role="alert">
    <i class="fa fa-exclamation-triangle"></i><b> Note:</b> Starting with v0.12.0, Prometheus Operator requires use of Kubernetes v1.7.x and up.
</div>


<p><strong>Deprecation Warning:</strong> The <em>custom configuration</em> option of the Prometheus Operator will be deprecated in favor of the <a href="./additional-scrape-config.md"><em>additional scrape config</em></a> option.</p>
<h1 id="Custom-Configuration"><a href="#Custom-Configuration" class="headerlink" title="Custom Configuration"></a>Custom Configuration</h1><p>There are a few reasons, why one may want to provide a custom configuration to Prometheus instances, instead of having the Prometheus Operator generate the configuration based on <code>ServiceMonitor</code> objects.</p>
<blockquote>
<p>Note that custom configurations are not the primary goal the Prometheus Operator is solving. Changes made in the Prometheus Operator, may affect custom configurations in a breaking way. Additionally the Prometheus Operator attempts to generate configurations in a forward and backward compatible way, with custom configurations, this is up to the user to manage gracefully.</p>
</blockquote>
<p>Use cases include:</p>
<ul>
<li>The necessity to use a service discovery mechanism other than the Kubernetes service discovery, such as AWS SD, Azure SD, etc.</li>
<li>Cases that are not (yet) very well supported by the Prometheus Operator, such as performing blackbox probes.</li>
</ul>
<p>Note that because the Prometheus Operator does not generate the Prometheus configuration in this case, any fields of the Prometheus resource, which influence the configuration will have no effect, and one has to specify this explicitly. The features that will not be supported, meaning they will have to be configured manually:</p>
<ul>
<li><code>serviceMonitorSelector</code>: Auto-generating Prometheus configuration from <code>ServiceMonitor</code> objects. This means, that creating <code>ServiceMonitor</code> objects is not how a Prometheus instance is configured, but rather the raw configuration has to be written.</li>
<li><code>alerting</code>: Alertmanager discovery as available in the Prometheus object is translated to the Prometheus configuration, meaning this configuration has to be done manually.</li>
<li><code>scrapeInterval</code></li>
<li><code>evaluationInterval</code></li>
<li><code>externalLabels</code></li>
</ul>
<p>In order to enable to specify a custom configuration, specify neither <code>serviceMonitorSelector</code> nor <code>podMonitorSelector</code>. When these fields are empty, the Prometheus Operator will not attempt to manage the <code>Secret</code>, that contains the Prometheus configuration. The <code>Secret</code>, that contains the Prometheus configuration is called <code>prometheus-&lt;name-of-prometheus-object&gt;</code>, in the same namespace as the Prometheus object. Within this <code>Secret</code>, the key that contains the Prometheus configuration is called <code>prometheus.yaml.gz</code>.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/Documentation/compatibility"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/Documentation/compatibility/" class="article-date">
  <time datetime="2020-12-12T13:30:47.153Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <br>
<div class="alert alert-info" role="alert">
    <i class="fa fa-exclamation-triangle"></i><b> Note:</b> Starting with v0.12.0, Prometheus Operator requires use of Kubernetes v1.7.x and up.
</div>

<h1 id="Compatibility"><a href="#Compatibility" class="headerlink" title="Compatibility"></a>Compatibility</h1><p>The Prometheus Operator supports a number of Kubernetes and Prometheus releases.</p>
<h2 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h2><p>The Prometheus Operator uses client-go to communicate with Kubernetes clusters. The supported Kubernetes cluster version is determined by client-go. The compatibility matrix for client-go and Kubernetes clusters can be found <a target="_blank" rel="noopener" href="https://github.com/kubernetes/client-go#compatibility-matrix">here</a>. All additional compatibility is only best effort, or happens to still/already be supported. The currently used client-go version is “v4.0.0-beta.0”.</p>
<p>Due to the use of CustomResourceDefinitions Kubernetes &gt;= v1.7.0 is required.</p>
<p>Due to the use of apiextensions.k8s.io/v1 CustomResourceDefinitions, prometheus-operator v0.39.0 onward requires Kubernetes &gt;= v1.16.0.</p>
<h2 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h2><p>The versions of Prometheus compatible to be run with the Prometheus Operator are:</p>
<ul>
<li>v1.4.0</li>
<li>v1.4.1</li>
<li>v1.5.0</li>
<li>v1.5.1</li>
<li>v1.5.2</li>
<li>v1.5.3</li>
<li>v1.6.0</li>
<li>v1.6.1</li>
<li>v1.6.2</li>
<li>v1.6.3</li>
<li>v1.7.0</li>
<li>v1.7.1</li>
<li>v1.7.2</li>
<li>v1.8.0</li>
<li>v2.0.0</li>
<li>v2.2.1</li>
<li>v2.3.1</li>
<li>v2.3.2</li>
<li>v2.4.0</li>
<li>v2.4.1</li>
<li>v2.4.2</li>
<li>v2.4.3</li>
<li>v2.5.0</li>
<li>v2.6.0</li>
<li>v2.6.1</li>
<li>v2.7.0</li>
<li>v2.7.1</li>
<li>v2.7.2</li>
<li>v2.8.1</li>
<li>v2.9.2</li>
<li>v2.10.0</li>
<li>v2.11.0</li>
<li>v2.14.0</li>
<li>v2.15.2</li>
<li>v2.16.0</li>
<li>v2.17.2</li>
<li>v2.18.0</li>
<li>v2.18.1</li>
</ul>
<h2 id="Alertmanager"><a href="#Alertmanager" class="headerlink" title="Alertmanager"></a>Alertmanager</h2><p>We only support Alertmanager v0.15 and above. Everything below v0.15 is on a<br>best effort basis.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/Documentation/api"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/Documentation/api/" class="article-date">
  <time datetime="2020-12-12T13:30:47.145Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <br>
<div class="alert alert-info" role="alert">
    <i class="fa fa-exclamation-triangle"></i><b> Note:</b> Starting with v0.12.0, Prometheus Operator requires use of Kubernetes v1.7.x and up.
</div>

<h1 id="API-Docs"><a href="#API-Docs" class="headerlink" title="API Docs"></a>API Docs</h1><p>This Document documents the types introduced by the Prometheus Operator to be consumed by users.</p>
<blockquote>
<p>Note this document is generated from code comments. When contributing a change to this document please do so by changing the code comments.</p>
</blockquote>
<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ul>
<li><a href="#apiserverconfig">APIServerConfig</a></li>
<li><a href="#alertingspec">AlertingSpec</a></li>
<li><a href="#alertmanager">Alertmanager</a></li>
<li><a href="#alertmanagerendpoints">AlertmanagerEndpoints</a></li>
<li><a href="#alertmanagerlist">AlertmanagerList</a></li>
<li><a href="#alertmanagerspec">AlertmanagerSpec</a></li>
<li><a href="#alertmanagerstatus">AlertmanagerStatus</a></li>
<li><a href="#arbitraryfsaccessthroughsmsconfig">ArbitraryFSAccessThroughSMsConfig</a></li>
<li><a href="#basicauth">BasicAuth</a></li>
<li><a href="#embeddedobjectmetadata">EmbeddedObjectMetadata</a></li>
<li><a href="#embeddedpersistentvolumeclaim">EmbeddedPersistentVolumeClaim</a></li>
<li><a href="#endpoint">Endpoint</a></li>
<li><a href="#namespaceselector">NamespaceSelector</a></li>
<li><a href="#podmetricsendpoint">PodMetricsEndpoint</a></li>
<li><a href="#podmonitor">PodMonitor</a></li>
<li><a href="#podmonitorlist">PodMonitorList</a></li>
<li><a href="#podmonitorspec">PodMonitorSpec</a></li>
<li><a href="#prometheus">Prometheus</a></li>
<li><a href="#prometheuslist">PrometheusList</a></li>
<li><a href="#prometheusrule">PrometheusRule</a></li>
<li><a href="#prometheusruleexcludeconfig">PrometheusRuleExcludeConfig</a></li>
<li><a href="#prometheusrulelist">PrometheusRuleList</a></li>
<li><a href="#prometheusrulespec">PrometheusRuleSpec</a></li>
<li><a href="#prometheusspec">PrometheusSpec</a></li>
<li><a href="#prometheusstatus">PrometheusStatus</a></li>
<li><a href="#queryspec">QuerySpec</a></li>
<li><a href="#queueconfig">QueueConfig</a></li>
<li><a href="#relabelconfig">RelabelConfig</a></li>
<li><a href="#remotereadspec">RemoteReadSpec</a></li>
<li><a href="#remotewritespec">RemoteWriteSpec</a></li>
<li><a href="#rule">Rule</a></li>
<li><a href="#rulegroup">RuleGroup</a></li>
<li><a href="#rules">Rules</a></li>
<li><a href="#rulesalert">RulesAlert</a></li>
<li><a href="#secretorconfigmap">SecretOrConfigMap</a></li>
<li><a href="#servicemonitor">ServiceMonitor</a></li>
<li><a href="#servicemonitorlist">ServiceMonitorList</a></li>
<li><a href="#servicemonitorspec">ServiceMonitorSpec</a></li>
<li><a href="#storagespec">StorageSpec</a></li>
<li><a href="#tlsconfig">TLSConfig</a></li>
<li><a href="#thanosspec">ThanosSpec</a></li>
<li><a href="#thanosruler">ThanosRuler</a></li>
<li><a href="#thanosrulerlist">ThanosRulerList</a></li>
<li><a href="#thanosrulerspec">ThanosRulerSpec</a></li>
<li><a href="#thanosrulerstatus">ThanosRulerStatus</a></li>
</ul>
<h2 id="APIServerConfig"><a href="#APIServerConfig" class="headerlink" title="APIServerConfig"></a>APIServerConfig</h2><p>APIServerConfig defines a host and auth methods to access apiserver. More info: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>host</td>
<td>Host of apiserver. A valid string consisting of a hostname or IP followed by an optional port number</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>basicAuth</td>
<td>BasicAuth allow an endpoint to authenticate over basic authentication</td>
<td>*<a href="#basicauth">BasicAuth</a></td>
<td>false</td>
</tr>
<tr>
<td>bearerToken</td>
<td>Bearer token for accessing apiserver.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>bearerTokenFile</td>
<td>File to read bearer token for accessing apiserver.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>tlsConfig</td>
<td>TLS Config to use for accessing apiserver.</td>
<td>*<a href="#tlsconfig">TLSConfig</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="AlertingSpec"><a href="#AlertingSpec" class="headerlink" title="AlertingSpec"></a>AlertingSpec</h2><p>AlertingSpec defines parameters for alerting configuration of Prometheus servers.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>alertmanagers</td>
<td>AlertmanagerEndpoints Prometheus should fire alerts against.</td>
<td>[]<a href="#alertmanagerendpoints">AlertmanagerEndpoints</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="Alertmanager"><a href="#Alertmanager" class="headerlink" title="Alertmanager"></a>Alertmanager</h2><p>Alertmanager describes an Alertmanager cluster.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#objectmeta-v1-meta">metav1.ObjectMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>spec</td>
<td>Specification of the desired behavior of the Alertmanager cluster. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></td>
<td><a href="#alertmanagerspec">AlertmanagerSpec</a></td>
<td>true</td>
</tr>
<tr>
<td>status</td>
<td>Most recent observed status of the Alertmanager cluster. Read-only. Not included when requesting from the apiserver, only from the Prometheus Operator API itself. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></td>
<td>*<a href="#alertmanagerstatus">AlertmanagerStatus</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="AlertmanagerEndpoints"><a href="#AlertmanagerEndpoints" class="headerlink" title="AlertmanagerEndpoints"></a>AlertmanagerEndpoints</h2><p>AlertmanagerEndpoints defines a selection of a single Endpoints object containing alertmanager IPs to fire alerts against.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>namespace</td>
<td>Namespace of Endpoints object.</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>name</td>
<td>Name of Endpoints object in Namespace.</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>port</td>
<td>Port the Alertmanager API is exposed on.</td>
<td>intstr.IntOrString</td>
<td>true</td>
</tr>
<tr>
<td>scheme</td>
<td>Scheme to use when firing alerts.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>pathPrefix</td>
<td>Prefix for the HTTP path alerts are pushed to.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>tlsConfig</td>
<td>TLS Config to use for alertmanager connection.</td>
<td>*<a href="#tlsconfig">TLSConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>bearerTokenFile</td>
<td>BearerTokenFile to read from filesystem to use when authenticating to Alertmanager.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>apiVersion</td>
<td>Version of the Alertmanager API that Prometheus uses to send alerts. It can be &quot;v1&quot; or &quot;v2&quot;.</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="AlertmanagerList"><a href="#AlertmanagerList" class="headerlink" title="AlertmanagerList"></a>AlertmanagerList</h2><p>AlertmanagerList is a list of Alertmanagers.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td>Standard list metadata More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata</a></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#listmeta-v1-meta">metav1.ListMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>items</td>
<td>List of Alertmanagers</td>
<td>[]<a href="#alertmanager">Alertmanager</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="AlertmanagerSpec"><a href="#AlertmanagerSpec" class="headerlink" title="AlertmanagerSpec"></a>AlertmanagerSpec</h2><p>AlertmanagerSpec is a specification of the desired behavior of the Alertmanager cluster. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>podMetadata</td>
<td>PodMetadata configures Labels and Annotations which are propagated to the alertmanager pods.</td>
<td>*<a href="#embeddedobjectmetadata">EmbeddedObjectMetadata</a></td>
<td>false</td>
</tr>
<tr>
<td>image</td>
<td>Image if specified has precedence over baseImage, tag and sha combinations. Specifying the version is still necessary to ensure the Prometheus Operator knows what version of Alertmanager is being configured.</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>version</td>
<td>Version the cluster should be on.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>tag</td>
<td>Tag of Alertmanager container image to be deployed. Defaults to the value of <code>version</code>. Version is ignored if Tag is set.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>sha</td>
<td>SHA of Alertmanager container image to be deployed. Defaults to the value of <code>version</code>. Similar to a tag, but the SHA explicitly deploys an immutable container image. Version and Tag are ignored if SHA is set.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>baseImage</td>
<td>Base image that is used to deploy pods, without tag.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>imagePullSecrets</td>
<td>An optional list of references to secrets in the same namespace to use for pulling prometheus and alertmanager images from registries see <a target="_blank" rel="noopener" href="http://kubernetes.io/docs/user-guide/images#specifying-imagepullsecrets-on-a-pod">http://kubernetes.io/docs/user-guide/images#specifying-imagepullsecrets-on-a-pod</a></td>
<td>[]<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#localobjectreference-v1-core">v1.LocalObjectReference</a></td>
<td>false</td>
</tr>
<tr>
<td>secrets</td>
<td>Secrets is a list of Secrets in the same namespace as the Alertmanager object, which shall be mounted into the Alertmanager Pods. The Secrets are mounted into /etc/alertmanager/secrets/<secret-name>.</secret-name></td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>configMaps</td>
<td>ConfigMaps is a list of ConfigMaps in the same namespace as the Alertmanager object, which shall be mounted into the Alertmanager Pods. The ConfigMaps are mounted into /etc/alertmanager/configmaps/<configmap-name>.</configmap-name></td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>configSecret</td>
<td>ConfigSecret is the name of a Kubernetes Secret in the same namespace as the Alertmanager object, which contains configuration for this Alertmanager instance. Defaults to ‘alertmanager-<alertmanager-name>‘ The secret is mounted into /etc/alertmanager/config.</alertmanager-name></td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>logLevel</td>
<td>Log level for Alertmanager to be configured with.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>logFormat</td>
<td>Log format for Alertmanager to be configured with.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>replicas</td>
<td>Size is the expected size of the alertmanager cluster. The controller will eventually make the size of the running cluster equal to the expected size.</td>
<td>*int32</td>
<td>false</td>
</tr>
<tr>
<td>retention</td>
<td>Time duration Alertmanager shall retain data for. Default is ‘120h’, and must match the regular expression <code>[0-9]+(ms|s|m|h)</code> (milliseconds seconds minutes hours).</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>storage</td>
<td>Storage is the definition of how storage will be used by the Alertmanager instances.</td>
<td>*<a href="#storagespec">StorageSpec</a></td>
<td>false</td>
</tr>
<tr>
<td>volumes</td>
<td>Volumes allows configuration of additional volumes on the output StatefulSet definition. Volumes specified will be appended to other volumes that are generated as a result of StorageSpec objects.</td>
<td>[]v1.Volume</td>
<td>false</td>
</tr>
<tr>
<td>volumeMounts</td>
<td>VolumeMounts allows configuration of additional VolumeMounts on the output StatefulSet definition. VolumeMounts specified will be appended to other VolumeMounts in the alertmanager container, that are generated as a result of StorageSpec objects.</td>
<td>[]v1.VolumeMount</td>
<td>false</td>
</tr>
<tr>
<td>externalUrl</td>
<td>The external URL the Alertmanager instances will be available under. This is necessary to generate correct URLs. This is necessary if Alertmanager is not served from root of a DNS name.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>routePrefix</td>
<td>The route prefix Alertmanager registers HTTP handlers for. This is useful, if using ExternalURL and a proxy is rewriting HTTP routes of a request, and the actual ExternalURL is still true, but the server serves requests under a different route prefix. For example for use with <code>kubectl proxy</code>.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>paused</td>
<td>If set to true all actions on the underlaying managed objects are not goint to be performed, except for delete actions.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>nodeSelector</td>
<td>Define which Nodes the Pods are scheduled on.</td>
<td>map[string]string</td>
<td>false</td>
</tr>
<tr>
<td>resources</td>
<td>Define resources requests and limits for single Pods.</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#resourcerequirements-v1-core">v1.ResourceRequirements</a></td>
<td>false</td>
</tr>
<tr>
<td>affinity</td>
<td>If specified, the pod’s scheduling constraints.</td>
<td>*v1.Affinity</td>
<td>false</td>
</tr>
<tr>
<td>tolerations</td>
<td>If specified, the pod’s tolerations.</td>
<td>[]v1.Toleration</td>
<td>false</td>
</tr>
<tr>
<td>securityContext</td>
<td>SecurityContext holds pod-level security attributes and common container settings. This defaults to the default PodSecurityContext.</td>
<td>*v1.PodSecurityContext</td>
<td>false</td>
</tr>
<tr>
<td>serviceAccountName</td>
<td>ServiceAccountName is the name of the ServiceAccount to use to run the Prometheus Pods.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>listenLocal</td>
<td>ListenLocal makes the Alertmanager server listen on loopback, so that it does not bind against the Pod IP. Note this is only for the Alertmanager UI, not the gossip communication.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>containers</td>
<td>Containers allows injecting additional containers. This is meant to allow adding an authentication proxy to an Alertmanager pod.</td>
<td>[]v1.Container</td>
<td>false</td>
</tr>
<tr>
<td>initContainers</td>
<td>InitContainers allows adding initContainers to the pod definition. Those can be used to e.g. fetch secrets for injection into the Alertmanager configuration from external sources. Any errors during the execution of an initContainer will lead to a restart of the Pod. More info: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">https://kubernetes.io/docs/concepts/workloads/pods/init-containers/</a> Using initContainers for any use case other then secret fetching is entirely outside the scope of what the maintainers will support and by doing so, you accept that this behaviour may break at any time without notice.</td>
<td>[]v1.Container</td>
<td>false</td>
</tr>
<tr>
<td>priorityClassName</td>
<td>Priority class assigned to the Pods</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>additionalPeers</td>
<td>AdditionalPeers allows injecting a set of additional Alertmanagers to peer with to form a highly available cluster.</td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>clusterAdvertiseAddress</td>
<td>ClusterAdvertiseAddress is the explicit address to advertise in cluster. Needs to be provided for non RFC1918 [1] (public) addresses. [1] RFC1918: <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1918">https://tools.ietf.org/html/rfc1918</a></td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>portName</td>
<td>Port name used for the pods and governing service. This defaults to web</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="AlertmanagerStatus"><a href="#AlertmanagerStatus" class="headerlink" title="AlertmanagerStatus"></a>AlertmanagerStatus</h2><p>AlertmanagerStatus is the most recent observed status of the Alertmanager cluster. Read-only. Not included when requesting from the apiserver, only from the Prometheus Operator API itself. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>paused</td>
<td>Represents whether any actions on the underlaying managed objects are being performed. Only delete actions will be performed.</td>
<td>bool</td>
<td>true</td>
</tr>
<tr>
<td>replicas</td>
<td>Total number of non-terminated pods targeted by this Alertmanager cluster (their labels match the selector).</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>updatedReplicas</td>
<td>Total number of non-terminated pods targeted by this Alertmanager cluster that have the desired version spec.</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>availableReplicas</td>
<td>Total number of available pods (ready for at least minReadySeconds) targeted by this Alertmanager cluster.</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>unavailableReplicas</td>
<td>Total number of unavailable pods targeted by this Alertmanager cluster.</td>
<td>int32</td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ArbitraryFSAccessThroughSMsConfig"><a href="#ArbitraryFSAccessThroughSMsConfig" class="headerlink" title="ArbitraryFSAccessThroughSMsConfig"></a>ArbitraryFSAccessThroughSMsConfig</h2><p>ArbitraryFSAccessThroughSMsConfig enables users to configure, whether a service monitor selected by the Prometheus instance is allowed to use arbitrary files on the file system of the Prometheus container. This is the case when e.g. a service monitor specifies a BearerTokenFile in an endpoint. A malicious user could create a service monitor selecting arbitrary secret files in the Prometheus container. Those secrets would then be sent with a scrape request by Prometheus to a malicious target. Denying the above would prevent the attack, users can instead use the BearerTokenSecret field.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>deny</td>
<td></td>
<td>bool</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="BasicAuth"><a href="#BasicAuth" class="headerlink" title="BasicAuth"></a>BasicAuth</h2><p>BasicAuth allow an endpoint to authenticate over basic authentication More info: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/operating/configuration/#endpoints">https://prometheus.io/docs/operating/configuration/#endpoints</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>username</td>
<td>The secret in the service monitor namespace that contains the username for authentication.</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>password</td>
<td>The secret in the service monitor namespace that contains the password for authentication.</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="EmbeddedObjectMetadata"><a href="#EmbeddedObjectMetadata" class="headerlink" title="EmbeddedObjectMetadata"></a>EmbeddedObjectMetadata</h2><p>EmbeddedObjectMetadata contains a subset of the fields included in k8s.io/apimachinery/pkg/apis/meta/v1.ObjectMeta Only fields which are relevant to embedded resources are included.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>Name must be unique within a namespace. Is required when creating resources, although some resources may allow a client to request the generation of an appropriate name automatically. Name is primarily intended for creation idempotence and configuration definition. Cannot be updated. More info: <a target="_blank" rel="noopener" href="http://kubernetes.io/docs/user-guide/identifiers#names">http://kubernetes.io/docs/user-guide/identifiers#names</a></td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>labels</td>
<td>Map of string keys and values that can be used to organize and categorize (scope and select) objects. May match selectors of replication controllers and services. More info: <a target="_blank" rel="noopener" href="http://kubernetes.io/docs/user-guide/labels">http://kubernetes.io/docs/user-guide/labels</a></td>
<td>map[string]string</td>
<td>false</td>
</tr>
<tr>
<td>annotations</td>
<td>Annotations is an unstructured key value map stored with a resource that may be set by external tools to store and retrieve arbitrary metadata. They are not queryable and should be preserved when modifying objects. More info: <a target="_blank" rel="noopener" href="http://kubernetes.io/docs/user-guide/annotations">http://kubernetes.io/docs/user-guide/annotations</a></td>
<td>map[string]string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="EmbeddedPersistentVolumeClaim"><a href="#EmbeddedPersistentVolumeClaim" class="headerlink" title="EmbeddedPersistentVolumeClaim"></a>EmbeddedPersistentVolumeClaim</h2><p>EmbeddedPersistentVolumeClaim is an embedded version of k8s.io/api/core/v1.PersistentVolumeClaim. It contains TypeMeta and a reduced ObjectMeta.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td>EmbeddedMetadata contains metadata relevant to an EmbeddedResource.</td>
<td><a href="#embeddedobjectmetadata">EmbeddedObjectMetadata</a></td>
<td>false</td>
</tr>
<tr>
<td>spec</td>
<td>Spec defines the desired characteristics of a volume requested by a pod author. More info: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes#persistentvolumeclaims">https://kubernetes.io/docs/concepts/storage/persistent-volumes#persistentvolumeclaims</a></td>
<td>v1.PersistentVolumeClaimSpec</td>
<td>false</td>
</tr>
<tr>
<td>status</td>
<td>Status represents the current information/status of a persistent volume claim. Read-only. More info: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes#persistentvolumeclaims">https://kubernetes.io/docs/concepts/storage/persistent-volumes#persistentvolumeclaims</a></td>
<td>v1.PersistentVolumeClaimStatus</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="Endpoint"><a href="#Endpoint" class="headerlink" title="Endpoint"></a>Endpoint</h2><p>Endpoint defines a scrapeable endpoint serving Prometheus metrics.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>port</td>
<td>Name of the service port this endpoint refers to. Mutually exclusive with targetPort.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>targetPort</td>
<td>Name or number of the pod port this endpoint refers to. Mutually exclusive with port.</td>
<td>*intstr.IntOrString</td>
<td>false</td>
</tr>
<tr>
<td>path</td>
<td>HTTP path to scrape for metrics.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>scheme</td>
<td>HTTP scheme to use for scraping.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>params</td>
<td>Optional HTTP URL parameters</td>
<td>map[string][]string</td>
<td>false</td>
</tr>
<tr>
<td>interval</td>
<td>Interval at which metrics should be scraped</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>scrapeTimeout</td>
<td>Timeout after which the scrape is ended</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>tlsConfig</td>
<td>TLS configuration to use when scraping the endpoint</td>
<td>*<a href="#tlsconfig">TLSConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>bearerTokenFile</td>
<td>File to read bearer token for scraping targets.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>bearerTokenSecret</td>
<td>Secret to mount to read bearer token for scraping targets. The secret needs to be in the same namespace as the service monitor and accessible by the Prometheus Operator.</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>honorLabels</td>
<td>HonorLabels chooses the metric’s labels on collisions with target labels.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>honorTimestamps</td>
<td>HonorTimestamps controls whether Prometheus respects the timestamps present in scraped data.</td>
<td>*bool</td>
<td>false</td>
</tr>
<tr>
<td>basicAuth</td>
<td>BasicAuth allow an endpoint to authenticate over basic authentication More info: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/operating/configuration/#endpoints">https://prometheus.io/docs/operating/configuration/#endpoints</a></td>
<td>*<a href="#basicauth">BasicAuth</a></td>
<td>false</td>
</tr>
<tr>
<td>metricRelabelings</td>
<td>MetricRelabelConfigs to apply to samples before ingestion.</td>
<td>[]*<a href="#relabelconfig">RelabelConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>relabelings</td>
<td>RelabelConfigs to apply to samples before scraping. More info: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config</a></td>
<td>[]*<a href="#relabelconfig">RelabelConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>proxyUrl</td>
<td>ProxyURL eg <a target="_blank" rel="noopener" href="http://proxyserver:2195/">http://proxyserver:2195</a> Directs scrapes to proxy through this endpoint.</td>
<td>*string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="NamespaceSelector"><a href="#NamespaceSelector" class="headerlink" title="NamespaceSelector"></a>NamespaceSelector</h2><p>NamespaceSelector is a selector for selecting either all namespaces or a list of namespaces.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>any</td>
<td>Boolean describing whether all namespaces are selected in contrast to a list restricting them.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>matchNames</td>
<td>List of namespace names.</td>
<td>[]string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PodMetricsEndpoint"><a href="#PodMetricsEndpoint" class="headerlink" title="PodMetricsEndpoint"></a>PodMetricsEndpoint</h2><p>PodMetricsEndpoint defines a scrapeable endpoint of a Kubernetes Pod serving Prometheus metrics.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>port</td>
<td>Name of the pod port this endpoint refers to. Mutually exclusive with targetPort.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>targetPort</td>
<td>Deprecated: Use ‘port’ instead.</td>
<td>*intstr.IntOrString</td>
<td>false</td>
</tr>
<tr>
<td>path</td>
<td>HTTP path to scrape for metrics.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>scheme</td>
<td>HTTP scheme to use for scraping.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>params</td>
<td>Optional HTTP URL parameters</td>
<td>map[string][]string</td>
<td>false</td>
</tr>
<tr>
<td>interval</td>
<td>Interval at which metrics should be scraped</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>scrapeTimeout</td>
<td>Timeout after which the scrape is ended</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>honorLabels</td>
<td>HonorLabels chooses the metric’s labels on collisions with target labels.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>honorTimestamps</td>
<td>HonorTimestamps controls whether Prometheus respects the timestamps present in scraped data.</td>
<td>*bool</td>
<td>false</td>
</tr>
<tr>
<td>metricRelabelings</td>
<td>MetricRelabelConfigs to apply to samples before ingestion.</td>
<td>[]*<a href="#relabelconfig">RelabelConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>relabelings</td>
<td>RelabelConfigs to apply to samples before ingestion. More info: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config</a></td>
<td>[]*<a href="#relabelconfig">RelabelConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>proxyUrl</td>
<td>ProxyURL eg <a target="_blank" rel="noopener" href="http://proxyserver:2195/">http://proxyserver:2195</a> Directs scrapes to proxy through this endpoint.</td>
<td>*string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PodMonitor"><a href="#PodMonitor" class="headerlink" title="PodMonitor"></a>PodMonitor</h2><p>PodMonitor defines monitoring for a set of pods.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#objectmeta-v1-meta">metav1.ObjectMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>spec</td>
<td>Specification of desired Pod selection for target discovery by Prometheus.</td>
<td><a href="#podmonitorspec">PodMonitorSpec</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PodMonitorList"><a href="#PodMonitorList" class="headerlink" title="PodMonitorList"></a>PodMonitorList</h2><p>PodMonitorList is a list of PodMonitors.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td>Standard list metadata More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata</a></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#listmeta-v1-meta">metav1.ListMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>items</td>
<td>List of PodMonitors</td>
<td>[]*<a href="#podmonitor">PodMonitor</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PodMonitorSpec"><a href="#PodMonitorSpec" class="headerlink" title="PodMonitorSpec"></a>PodMonitorSpec</h2><p>PodMonitorSpec contains specification parameters for a PodMonitor.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>jobLabel</td>
<td>The label to use to retrieve the job name from.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>podTargetLabels</td>
<td>PodTargetLabels transfers labels on the Kubernetes Pod onto the target.</td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>podMetricsEndpoints</td>
<td>A list of endpoints allowed as part of this PodMonitor.</td>
<td>[]<a href="#podmetricsendpoint">PodMetricsEndpoint</a></td>
<td>true</td>
</tr>
<tr>
<td>selector</td>
<td>Selector to select Pod objects.</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>true</td>
</tr>
<tr>
<td>namespaceSelector</td>
<td>Selector to select which namespaces the Endpoints objects are discovered from.</td>
<td><a href="#namespaceselector">NamespaceSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>sampleLimit</td>
<td>SampleLimit defines per-scrape limit on number of scraped samples that will be accepted.</td>
<td>uint64</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h2><p>Prometheus defines a Prometheus deployment.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#objectmeta-v1-meta">metav1.ObjectMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>spec</td>
<td>Specification of the desired behavior of the Prometheus cluster. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></td>
<td><a href="#prometheusspec">PrometheusSpec</a></td>
<td>true</td>
</tr>
<tr>
<td>status</td>
<td>Most recent observed status of the Prometheus cluster. Read-only. Not included when requesting from the apiserver, only from the Prometheus Operator API itself. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></td>
<td>*<a href="#prometheusstatus">PrometheusStatus</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PrometheusList"><a href="#PrometheusList" class="headerlink" title="PrometheusList"></a>PrometheusList</h2><p>PrometheusList is a list of Prometheuses.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td>Standard list metadata More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata</a></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#listmeta-v1-meta">metav1.ListMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>items</td>
<td>List of Prometheuses</td>
<td>[]*<a href="#prometheus">Prometheus</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PrometheusRule"><a href="#PrometheusRule" class="headerlink" title="PrometheusRule"></a>PrometheusRule</h2><p>PrometheusRule defines alerting rules for a Prometheus instance</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#objectmeta-v1-meta">metav1.ObjectMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>spec</td>
<td>Specification of desired alerting rule definitions for Prometheus.</td>
<td><a href="#prometheusrulespec">PrometheusRuleSpec</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PrometheusRuleExcludeConfig"><a href="#PrometheusRuleExcludeConfig" class="headerlink" title="PrometheusRuleExcludeConfig"></a>PrometheusRuleExcludeConfig</h2><p>PrometheusRuleExcludeConfig enables users to configure excluded PrometheusRule names and their namespaces to be ignored while enforcing namespace label for alerts and metrics.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>ruleNamespace</td>
<td>RuleNamespace - namespace of excluded rule</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>ruleName</td>
<td>RuleNamespace - name of excluded rule</td>
<td>string</td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PrometheusRuleList"><a href="#PrometheusRuleList" class="headerlink" title="PrometheusRuleList"></a>PrometheusRuleList</h2><p>PrometheusRuleList is a list of PrometheusRules.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td>Standard list metadata More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata</a></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#listmeta-v1-meta">metav1.ListMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>items</td>
<td>List of Rules</td>
<td>[]*<a href="#prometheusrule">PrometheusRule</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PrometheusRuleSpec"><a href="#PrometheusRuleSpec" class="headerlink" title="PrometheusRuleSpec"></a>PrometheusRuleSpec</h2><p>PrometheusRuleSpec contains specification parameters for a Rule.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>groups</td>
<td>Content of Prometheus rule file</td>
<td>[]<a href="#rulegroup">RuleGroup</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PrometheusSpec"><a href="#PrometheusSpec" class="headerlink" title="PrometheusSpec"></a>PrometheusSpec</h2><p>PrometheusSpec is a specification of the desired behavior of the Prometheus cluster. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>podMetadata</td>
<td>PodMetadata configures Labels and Annotations which are propagated to the prometheus pods.</td>
<td>*<a href="#embeddedobjectmetadata">EmbeddedObjectMetadata</a></td>
<td>false</td>
</tr>
<tr>
<td>serviceMonitorSelector</td>
<td>ServiceMonitors to be selected for target discovery. <em>Deprecated:</em> if neither this nor podMonitorSelector are specified, configuration is unmanaged.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>serviceMonitorNamespaceSelector</td>
<td>Namespaces to be selected for ServiceMonitor discovery. If nil, only check own namespace.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>podMonitorSelector</td>
<td><em>Experimental</em> PodMonitors to be selected for target discovery. <em>Deprecated:</em> if neither this nor serviceMonitorSelector are specified, configuration is unmanaged.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>podMonitorNamespaceSelector</td>
<td>Namespaces to be selected for PodMonitor discovery. If nil, only check own namespace.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>version</td>
<td>Version of Prometheus to be deployed.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>tag</td>
<td>Tag of Prometheus container image to be deployed. Defaults to the value of <code>version</code>. Version is ignored if Tag is set.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>sha</td>
<td>SHA of Prometheus container image to be deployed. Defaults to the value of <code>version</code>. Similar to a tag, but the SHA explicitly deploys an immutable container image. Version and Tag are ignored if SHA is set.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>paused</td>
<td>When a Prometheus deployment is paused, no actions except for deletion will be performed on the underlying objects.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>image</td>
<td>Image if specified has precedence over baseImage, tag and sha combinations. Specifying the version is still necessary to ensure the Prometheus Operator knows what version of Prometheus is being configured.</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>baseImage</td>
<td>Base image to use for a Prometheus deployment.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>imagePullSecrets</td>
<td>An optional list of references to secrets in the same namespace to use for pulling prometheus and alertmanager images from registries see <a target="_blank" rel="noopener" href="http://kubernetes.io/docs/user-guide/images#specifying-imagepullsecrets-on-a-pod">http://kubernetes.io/docs/user-guide/images#specifying-imagepullsecrets-on-a-pod</a></td>
<td>[]<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#localobjectreference-v1-core">v1.LocalObjectReference</a></td>
<td>false</td>
</tr>
<tr>
<td>replicas</td>
<td>Number of instances to deploy for a Prometheus deployment.</td>
<td>*int32</td>
<td>false</td>
</tr>
<tr>
<td>replicaExternalLabelName</td>
<td>Name of Prometheus external label used to denote replica name. Defaults to the value of <code>prometheus_replica</code>. External label will <em>not</em> be added when value is set to empty string (<code>\&quot;\&quot;</code>).</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>prometheusExternalLabelName</td>
<td>Name of Prometheus external label used to denote Prometheus instance name. Defaults to the value of <code>prometheus</code>. External label will <em>not</em> be added when value is set to empty string (<code>\&quot;\&quot;</code>).</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>retention</td>
<td>Time duration Prometheus shall retain data for. Default is ‘24h’, and must match the regular expression <code>[0-9]+(ms|s|m|h|d|w|y)</code> (milliseconds seconds minutes hours days weeks years).</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>retentionSize</td>
<td>Maximum amount of disk space used by blocks.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>disableCompaction</td>
<td>Disable prometheus compaction.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>walCompression</td>
<td>Enable compression of the write-ahead log using Snappy. This flag is only available in versions of Prometheus &gt;= 2.11.0.</td>
<td>*bool</td>
<td>false</td>
</tr>
<tr>
<td>logLevel</td>
<td>Log level for Prometheus to be configured with.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>logFormat</td>
<td>Log format for Prometheus to be configured with.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>scrapeInterval</td>
<td>Interval between consecutive scrapes.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>evaluationInterval</td>
<td>Interval between consecutive evaluations.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>rules</td>
<td>/–rules.*/ command-line arguments.</td>
<td><a href="#rules">Rules</a></td>
<td>false</td>
</tr>
<tr>
<td>externalLabels</td>
<td>The labels to add to any time series or alerts when communicating with external systems (federation, remote storage, Alertmanager).</td>
<td>map[string]string</td>
<td>false</td>
</tr>
<tr>
<td>enableAdminAPI</td>
<td>Enable access to prometheus web admin API. Defaults to the value of <code>false</code>. WARNING: Enabling the admin APIs enables mutating endpoints, to delete data, shutdown Prometheus, and more. Enabling this should be done with care and the user is advised to add additional authentication authorization via a proxy to ensure only clients authorized to perform these actions can do so. For more information see <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/querying/api/#tsdb-admin-apis">https://prometheus.io/docs/prometheus/latest/querying/api/#tsdb-admin-apis</a></td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>externalUrl</td>
<td>The external URL the Prometheus instances will be available under. This is necessary to generate correct URLs. This is necessary if Prometheus is not served from root of a DNS name.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>routePrefix</td>
<td>The route prefix Prometheus registers HTTP handlers for. This is useful, if using ExternalURL and a proxy is rewriting HTTP routes of a request, and the actual ExternalURL is still true, but the server serves requests under a different route prefix. For example for use with <code>kubectl proxy</code>.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>query</td>
<td>QuerySpec defines the query command line flags when starting Prometheus.</td>
<td>*<a href="#queryspec">QuerySpec</a></td>
<td>false</td>
</tr>
<tr>
<td>storage</td>
<td>Storage spec to specify how storage shall be used.</td>
<td>*<a href="#storagespec">StorageSpec</a></td>
<td>false</td>
</tr>
<tr>
<td>volumes</td>
<td>Volumes allows configuration of additional volumes on the output StatefulSet definition. Volumes specified will be appended to other volumes that are generated as a result of StorageSpec objects.</td>
<td>[]v1.Volume</td>
<td>false</td>
</tr>
<tr>
<td>volumeMounts</td>
<td>VolumeMounts allows configuration of additional VolumeMounts on the output StatefulSet definition. VolumeMounts specified will be appended to other VolumeMounts in the prometheus container, that are generated as a result of StorageSpec objects.</td>
<td>[]v1.VolumeMount</td>
<td>false</td>
</tr>
<tr>
<td>ruleSelector</td>
<td>A selector to select which PrometheusRules to mount for loading alerting/recording rules from. Until (excluding) Prometheus Operator v0.24.0 Prometheus Operator will migrate any legacy rule ConfigMaps to PrometheusRule custom resources selected by RuleSelector. Make sure it does not match any config maps that you do not want to be migrated.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>ruleNamespaceSelector</td>
<td>Namespaces to be selected for PrometheusRules discovery. If unspecified, only the same namespace as the Prometheus object is in is used.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>alerting</td>
<td>Define details regarding alerting.</td>
<td>*<a href="#alertingspec">AlertingSpec</a></td>
<td>false</td>
</tr>
<tr>
<td>resources</td>
<td>Define resources requests and limits for single Pods.</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#resourcerequirements-v1-core">v1.ResourceRequirements</a></td>
<td>false</td>
</tr>
<tr>
<td>nodeSelector</td>
<td>Define which Nodes the Pods are scheduled on.</td>
<td>map[string]string</td>
<td>false</td>
</tr>
<tr>
<td>serviceAccountName</td>
<td>ServiceAccountName is the name of the ServiceAccount to use to run the Prometheus Pods.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>secrets</td>
<td>Secrets is a list of Secrets in the same namespace as the Prometheus object, which shall be mounted into the Prometheus Pods. The Secrets are mounted into /etc/prometheus/secrets/<secret-name>.</secret-name></td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>configMaps</td>
<td>ConfigMaps is a list of ConfigMaps in the same namespace as the Prometheus object, which shall be mounted into the Prometheus Pods. The ConfigMaps are mounted into /etc/prometheus/configmaps/<configmap-name>.</configmap-name></td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>affinity</td>
<td>If specified, the pod’s scheduling constraints.</td>
<td>*v1.Affinity</td>
<td>false</td>
</tr>
<tr>
<td>tolerations</td>
<td>If specified, the pod’s tolerations.</td>
<td>[]v1.Toleration</td>
<td>false</td>
</tr>
<tr>
<td>remoteWrite</td>
<td>If specified, the remote_write spec. This is an experimental feature, it may change in any upcoming release in a breaking way.</td>
<td>[]<a href="#remotewritespec">RemoteWriteSpec</a></td>
<td>false</td>
</tr>
<tr>
<td>remoteRead</td>
<td>If specified, the remote_read spec. This is an experimental feature, it may change in any upcoming release in a breaking way.</td>
<td>[]<a href="#remotereadspec">RemoteReadSpec</a></td>
<td>false</td>
</tr>
<tr>
<td>securityContext</td>
<td>SecurityContext holds pod-level security attributes and common container settings. This defaults to the default PodSecurityContext.</td>
<td>*v1.PodSecurityContext</td>
<td>false</td>
</tr>
<tr>
<td>listenLocal</td>
<td>ListenLocal makes the Prometheus server listen on loopback, so that it does not bind against the Pod IP.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>containers</td>
<td>Containers allows injecting additional containers or modifying operator generated containers. This can be used to allow adding an authentication proxy to a Prometheus pod or to change the behavior of an operator generated container. Containers described here modify an operator generated container if they share the same name and modifications are done via a strategic merge patch. The current container names are: <code>prometheus</code>, <code>prometheus-config-reloader</code>, <code>rules-configmap-reloader</code>, and <code>thanos-sidecar</code>. Overriding containers is entirely outside the scope of what the maintainers will support and by doing so, you accept that this behaviour may break at any time without notice.</td>
<td>[]v1.Container</td>
<td>false</td>
</tr>
<tr>
<td>initContainers</td>
<td>InitContainers allows adding initContainers to the pod definition. Those can be used to e.g. fetch secrets for injection into the Prometheus configuration from external sources. Any errors during the execution of an initContainer will lead to a restart of the Pod. More info: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">https://kubernetes.io/docs/concepts/workloads/pods/init-containers/</a> Using initContainers for any use case other then secret fetching is entirely outside the scope of what the maintainers will support and by doing so, you accept that this behaviour may break at any time without notice.</td>
<td>[]v1.Container</td>
<td>false</td>
</tr>
<tr>
<td>additionalScrapeConfigs</td>
<td>AdditionalScrapeConfigs allows specifying a key of a Secret containing additional Prometheus scrape configurations. Scrape configurations specified are appended to the configurations generated by the Prometheus Operator. Job configurations specified must have the form as specified in the official Prometheus documentation: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config</a>. As scrape configs are appended, the user is responsible to make sure it is valid. Note that using this feature may expose the possibility to break upgrades of Prometheus. It is advised to review Prometheus release notes to ensure that no incompatible scrape configs are going to break Prometheus after the upgrade.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>additionalAlertRelabelConfigs</td>
<td>AdditionalAlertRelabelConfigs allows specifying a key of a Secret containing additional Prometheus alert relabel configurations. Alert relabel configurations specified are appended to the configurations generated by the Prometheus Operator. Alert relabel configurations specified must have the form as specified in the official Prometheus documentation: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#alert_relabel_configs">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#alert_relabel_configs</a>. As alert relabel configs are appended, the user is responsible to make sure it is valid. Note that using this feature may expose the possibility to break upgrades of Prometheus. It is advised to review Prometheus release notes to ensure that no incompatible alert relabel configs are going to break Prometheus after the upgrade.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>additionalAlertManagerConfigs</td>
<td>AdditionalAlertManagerConfigs allows specifying a key of a Secret containing additional Prometheus AlertManager configurations. AlertManager configurations specified are appended to the configurations generated by the Prometheus Operator. Job configurations specified must have the form as specified in the official Prometheus documentation: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#alertmanager_config">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#alertmanager_config</a>. As AlertManager configs are appended, the user is responsible to make sure it is valid. Note that using this feature may expose the possibility to break upgrades of Prometheus. It is advised to review Prometheus release notes to ensure that no incompatible AlertManager configs are going to break Prometheus after the upgrade.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>apiserverConfig</td>
<td>APIServerConfig allows specifying a host and auth methods to access apiserver. If left empty, Prometheus is assumed to run inside of the cluster and will discover API servers automatically and use the pod’s CA certificate and bearer token file at /var/run/secrets/kubernetes.io/serviceaccount/.</td>
<td>*<a href="#apiserverconfig">APIServerConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>thanos</td>
<td>Thanos configuration allows configuring various aspects of a Prometheus server in a Thanos environment.\n\nThis section is experimental, it may change significantly without deprecation notice in any release.\n\nThis is experimental and may change significantly without backward compatibility in any release.</td>
<td>*<a href="#thanosspec">ThanosSpec</a></td>
<td>false</td>
</tr>
<tr>
<td>priorityClassName</td>
<td>Priority class assigned to the Pods</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>portName</td>
<td>Port name used for the pods and governing service. This defaults to web</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>arbitraryFSAccessThroughSMs</td>
<td>ArbitraryFSAccessThroughSMs configures whether configuration based on a service monitor can access arbitrary files on the file system of the Prometheus container e.g. bearer token files.</td>
<td><a href="#arbitraryfsaccessthroughsmsconfig">ArbitraryFSAccessThroughSMsConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>overrideHonorLabels</td>
<td>OverrideHonorLabels if set to true overrides all user configured honor_labels. If HonorLabels is set in ServiceMonitor or PodMonitor to true, this overrides honor_labels to false.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>overrideHonorTimestamps</td>
<td>OverrideHonorTimestamps allows to globally enforce honoring timestamps in all scrape configs.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>ignoreNamespaceSelectors</td>
<td>IgnoreNamespaceSelectors if set to true will ignore NamespaceSelector settings from the podmonitor and servicemonitor configs, and they will only discover endpoints within their current namespace.  Defaults to false.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>enforcedNamespaceLabel</td>
<td>EnforcedNamespaceLabel enforces adding a namespace label of origin for each alert and metric that is user created. The label value will always be the namespace of the object that is being created.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>prometheusRulesExcludedFromEnforce</td>
<td>PrometheusRulesExcludedFromEnforce - list of prometheus rules to be excluded from enforcing of adding namespace labels. Works only if enforcedNamespaceLabel set to true. Make sure both ruleNamespace and ruleName are set for each pair</td>
<td>[]<a href="#prometheusruleexcludeconfig">PrometheusRuleExcludeConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>queryLogFile</td>
<td>QueryLogFile specifies the file to which PromQL queries are logged. Note that this location must be writable, and can be persisted using an attached volume. Alternatively, the location can be set to a stdout location such as <code>/dev/stdout</code> to log querie information to the default Prometheus log stream. This is only available in versions of Prometheus &gt;= 2.16.0. For more details, see the Prometheus docs (<a target="_blank" rel="noopener" href="https://prometheus.io/docs/guides/query-log/">https://prometheus.io/docs/guides/query-log/</a>)</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="PrometheusStatus"><a href="#PrometheusStatus" class="headerlink" title="PrometheusStatus"></a>PrometheusStatus</h2><p>PrometheusStatus is the most recent observed status of the Prometheus cluster. Read-only. Not included when requesting from the apiserver, only from the Prometheus Operator API itself. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>paused</td>
<td>Represents whether any actions on the underlaying managed objects are being performed. Only delete actions will be performed.</td>
<td>bool</td>
<td>true</td>
</tr>
<tr>
<td>replicas</td>
<td>Total number of non-terminated pods targeted by this Prometheus deployment (their labels match the selector).</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>updatedReplicas</td>
<td>Total number of non-terminated pods targeted by this Prometheus deployment that have the desired version spec.</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>availableReplicas</td>
<td>Total number of available pods (ready for at least minReadySeconds) targeted by this Prometheus deployment.</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>unavailableReplicas</td>
<td>Total number of unavailable pods targeted by this Prometheus deployment.</td>
<td>int32</td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="QuerySpec"><a href="#QuerySpec" class="headerlink" title="QuerySpec"></a>QuerySpec</h2><p>QuerySpec defines the query command line flags when starting Prometheus.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>lookbackDelta</td>
<td>The delta difference allowed for retrieving metrics during expression evaluations.</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>maxConcurrency</td>
<td>Number of concurrent queries that can be run at once.</td>
<td>*int32</td>
<td>false</td>
</tr>
<tr>
<td>maxSamples</td>
<td>Maximum number of samples a single query can load into memory. Note that queries will fail if they would load more samples than this into memory, so this also limits the number of samples a query can return.</td>
<td>*int32</td>
<td>false</td>
</tr>
<tr>
<td>timeout</td>
<td>Maximum time a query may take before being aborted.</td>
<td>*string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="QueueConfig"><a href="#QueueConfig" class="headerlink" title="QueueConfig"></a>QueueConfig</h2><p>QueueConfig allows the tuning of remote_write queue_config parameters. This object is referenced in the RemoteWriteSpec object.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>capacity</td>
<td>Capacity is the number of samples to buffer per shard before we start dropping them.</td>
<td>int</td>
<td>false</td>
</tr>
<tr>
<td>minShards</td>
<td>MinShards is the minimum number of shards, i.e. amount of concurrency.</td>
<td>int</td>
<td>false</td>
</tr>
<tr>
<td>maxShards</td>
<td>MaxShards is the maximum number of shards, i.e. amount of concurrency.</td>
<td>int</td>
<td>false</td>
</tr>
<tr>
<td>maxSamplesPerSend</td>
<td>MaxSamplesPerSend is the maximum number of samples per send.</td>
<td>int</td>
<td>false</td>
</tr>
<tr>
<td>batchSendDeadline</td>
<td>BatchSendDeadline is the maximum time a sample will wait in buffer.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>maxRetries</td>
<td>MaxRetries is the maximum number of times to retry a batch on recoverable errors.</td>
<td>int</td>
<td>false</td>
</tr>
<tr>
<td>minBackoff</td>
<td>MinBackoff is the initial retry delay. Gets doubled for every retry.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>maxBackoff</td>
<td>MaxBackoff is the maximum retry delay.</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="RelabelConfig"><a href="#RelabelConfig" class="headerlink" title="RelabelConfig"></a>RelabelConfig</h2><p>RelabelConfig allows dynamic rewriting of the label set, being applied to samples before ingestion. It defines <code>&lt;metric_relabel_configs&gt;</code>-section of Prometheus configuration. More info: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#metric_relabel_configs">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#metric_relabel_configs</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>sourceLabels</td>
<td>The source labels select values from existing labels. Their content is concatenated using the configured separator and matched against the configured regular expression for the replace, keep, and drop actions.</td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>separator</td>
<td>Separator placed between concatenated source label values. default is ‘;’.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>targetLabel</td>
<td>Label to which the resulting value is written in a replace action. It is mandatory for replace actions. Regex capture groups are available.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>regex</td>
<td>Regular expression against which the extracted value is matched. Default is ‘(.*)’</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>modulus</td>
<td>Modulus to take of the hash of the source label values.</td>
<td>uint64</td>
<td>false</td>
</tr>
<tr>
<td>replacement</td>
<td>Replacement value against which a regex replace is performed if the regular expression matches. Regex capture groups are available. Default is ‘$1’</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>action</td>
<td>Action to perform based on regex matching. Default is ‘replace’</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="RemoteReadSpec"><a href="#RemoteReadSpec" class="headerlink" title="RemoteReadSpec"></a>RemoteReadSpec</h2><p>RemoteReadSpec defines the remote_read configuration for prometheus.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>url</td>
<td>The URL of the endpoint to send samples to.</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>name</td>
<td>The name of the remote read queue, must be unique if specified. The name is used in metrics and logging in order to differentiate read configurations.  Only valid in Prometheus versions 2.15.0 and newer.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>requiredMatchers</td>
<td>An optional list of equality matchers which have to be present in a selector to query the remote read endpoint.</td>
<td>map[string]string</td>
<td>false</td>
</tr>
<tr>
<td>remoteTimeout</td>
<td>Timeout for requests to the remote read endpoint.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>readRecent</td>
<td>Whether reads should be made for queries for time ranges that the local storage should have complete data for.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>basicAuth</td>
<td>BasicAuth for the URL.</td>
<td>*<a href="#basicauth">BasicAuth</a></td>
<td>false</td>
</tr>
<tr>
<td>bearerToken</td>
<td>bearer token for remote read.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>bearerTokenFile</td>
<td>File to read bearer token for remote read.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>tlsConfig</td>
<td>TLS Config to use for remote read.</td>
<td>*<a href="#tlsconfig">TLSConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>proxyUrl</td>
<td>Optional ProxyURL</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="RemoteWriteSpec"><a href="#RemoteWriteSpec" class="headerlink" title="RemoteWriteSpec"></a>RemoteWriteSpec</h2><p>RemoteWriteSpec defines the remote_write configuration for prometheus.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>url</td>
<td>The URL of the endpoint to send samples to.</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>name</td>
<td>The name of the remote write queue, must be unique if specified. The name is used in metrics and logging in order to differentiate queues. Only valid in Prometheus versions 2.15.0 and newer.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>remoteTimeout</td>
<td>Timeout for requests to the remote write endpoint.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>writeRelabelConfigs</td>
<td>The list of remote write relabel configurations.</td>
<td>[]<a href="#relabelconfig">RelabelConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>basicAuth</td>
<td>BasicAuth for the URL.</td>
<td>*<a href="#basicauth">BasicAuth</a></td>
<td>false</td>
</tr>
<tr>
<td>bearerToken</td>
<td>File to read bearer token for remote write.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>bearerTokenFile</td>
<td>File to read bearer token for remote write.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>tlsConfig</td>
<td>TLS Config to use for remote write.</td>
<td>*<a href="#tlsconfig">TLSConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>proxyUrl</td>
<td>Optional ProxyURL</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>queueConfig</td>
<td>QueueConfig allows tuning of the remote write queue parameters.</td>
<td>*<a href="#queueconfig">QueueConfig</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="Rule"><a href="#Rule" class="headerlink" title="Rule"></a>Rule</h2><p>Rule describes an alerting or recording rule.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>record</td>
<td></td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>alert</td>
<td></td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>expr</td>
<td></td>
<td>intstr.IntOrString</td>
<td>true</td>
</tr>
<tr>
<td>for</td>
<td></td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>labels</td>
<td></td>
<td>map[string]string</td>
<td>false</td>
</tr>
<tr>
<td>annotations</td>
<td></td>
<td>map[string]string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="RuleGroup"><a href="#RuleGroup" class="headerlink" title="RuleGroup"></a>RuleGroup</h2><p>RuleGroup is a list of sequentially evaluated recording and alerting rules. Note: PartialResponseStrategy is only used by ThanosRuler and will be ignored by Prometheus instances.  Valid values for this field are ‘warn’ or ‘abort’.  More info: <a target="_blank" rel="noopener" href="https://github.com/thanos-io/thanos/blob/master/docs/components/rule.md#partial-response">https://github.com/thanos-io/thanos/blob/master/docs/components/rule.md#partial-response</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td></td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>interval</td>
<td></td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>rules</td>
<td></td>
<td>[]<a href="#rule">Rule</a></td>
<td>true</td>
</tr>
<tr>
<td>partial_response_strategy</td>
<td></td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h2><p>/–rules.*/ command-line arguments</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>alert</td>
<td></td>
<td><a href="#rulesalert">RulesAlert</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="RulesAlert"><a href="#RulesAlert" class="headerlink" title="RulesAlert"></a>RulesAlert</h2><p>/–rules.alert.*/ command-line arguments</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>forOutageTolerance</td>
<td>Max time to tolerate prometheus outage for restoring ‘for’ state of alert.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>forGracePeriod</td>
<td>Minimum duration between alert and restored ‘for’ state. This is maintained only for alerts with configured ‘for’ time greater than grace period.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>resendDelay</td>
<td>Minimum amount of time to wait before resending an alert to Alertmanager.</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="SecretOrConfigMap"><a href="#SecretOrConfigMap" class="headerlink" title="SecretOrConfigMap"></a>SecretOrConfigMap</h2><p>SecretOrConfigMap allows to specify data as a Secret or ConfigMap. Fields are mutually exclusive.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>secret</td>
<td>Secret containing data to use for the targets.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>configMap</td>
<td>ConfigMap containing data to use for the targets.</td>
<td>*v1.ConfigMapKeySelector</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ServiceMonitor"><a href="#ServiceMonitor" class="headerlink" title="ServiceMonitor"></a>ServiceMonitor</h2><p>ServiceMonitor defines monitoring for a set of services.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#objectmeta-v1-meta">metav1.ObjectMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>spec</td>
<td>Specification of desired Service selection for target discovery by Prometheus.</td>
<td><a href="#servicemonitorspec">ServiceMonitorSpec</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ServiceMonitorList"><a href="#ServiceMonitorList" class="headerlink" title="ServiceMonitorList"></a>ServiceMonitorList</h2><p>ServiceMonitorList is a list of ServiceMonitors.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td>Standard list metadata More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata</a></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#listmeta-v1-meta">metav1.ListMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>items</td>
<td>List of ServiceMonitors</td>
<td>[]*<a href="#servicemonitor">ServiceMonitor</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ServiceMonitorSpec"><a href="#ServiceMonitorSpec" class="headerlink" title="ServiceMonitorSpec"></a>ServiceMonitorSpec</h2><p>ServiceMonitorSpec contains specification parameters for a ServiceMonitor.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>jobLabel</td>
<td>The label to use to retrieve the job name from.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>targetLabels</td>
<td>TargetLabels transfers labels on the Kubernetes Service onto the target.</td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>podTargetLabels</td>
<td>PodTargetLabels transfers labels on the Kubernetes Pod onto the target.</td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>endpoints</td>
<td>A list of endpoints allowed as part of this ServiceMonitor.</td>
<td>[]<a href="#endpoint">Endpoint</a></td>
<td>true</td>
</tr>
<tr>
<td>selector</td>
<td>Selector to select Endpoints objects.</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>true</td>
</tr>
<tr>
<td>namespaceSelector</td>
<td>Selector to select which namespaces the Endpoints objects are discovered from.</td>
<td><a href="#namespaceselector">NamespaceSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>sampleLimit</td>
<td>SampleLimit defines per-scrape limit on number of scraped samples that will be accepted.</td>
<td>uint64</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="StorageSpec"><a href="#StorageSpec" class="headerlink" title="StorageSpec"></a>StorageSpec</h2><p>StorageSpec defines the configured storage for a group Prometheus servers. If neither <code>emptyDir</code> nor <code>volumeClaimTemplate</code> is specified, then by default an <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir">EmptyDir</a> will be used.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>disableMountSubPath</td>
<td>Deprecated: subPath usage will be disabled by default in a future release, this option will become unnecessary. DisableMountSubPath allows to remove any subPath usage in volume mounts.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>emptyDir</td>
<td>EmptyDirVolumeSource to be used by the Prometheus StatefulSets. If specified, used in place of any volumeClaimTemplate. More info: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir">https://kubernetes.io/docs/concepts/storage/volumes/#emptydir</a></td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#emptydirvolumesource-v1-core">v1.EmptyDirVolumeSource</a></td>
<td>false</td>
</tr>
<tr>
<td>volumeClaimTemplate</td>
<td>A PVC spec to be used by the Prometheus StatefulSets.</td>
<td><a href="#embeddedpersistentvolumeclaim">EmbeddedPersistentVolumeClaim</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="TLSConfig"><a href="#TLSConfig" class="headerlink" title="TLSConfig"></a>TLSConfig</h2><p>TLSConfig specifies TLS configuration parameters.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>caFile</td>
<td>Path to the CA cert in the Prometheus container to use for the targets.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>ca</td>
<td>Stuct containing the CA cert to use for the targets.</td>
<td><a href="#secretorconfigmap">SecretOrConfigMap</a></td>
<td>false</td>
</tr>
<tr>
<td>certFile</td>
<td>Path to the client cert file in the Prometheus container for the targets.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>cert</td>
<td>Struct containing the client cert file for the targets.</td>
<td><a href="#secretorconfigmap">SecretOrConfigMap</a></td>
<td>false</td>
</tr>
<tr>
<td>keyFile</td>
<td>Path to the client key file in the Prometheus container for the targets.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>keySecret</td>
<td>Secret containing the client key file for the targets.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>serverName</td>
<td>Used to verify the hostname for the targets.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>insecureSkipVerify</td>
<td>Disable target certificate validation.</td>
<td>bool</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ThanosSpec"><a href="#ThanosSpec" class="headerlink" title="ThanosSpec"></a>ThanosSpec</h2><p>ThanosSpec defines parameters for a Prometheus server within a Thanos deployment.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>image</td>
<td>Image if specified has precedence over baseImage, tag and sha combinations. Specifying the version is still necessary to ensure the Prometheus Operator knows what version of Thanos is being configured.</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>version</td>
<td>Version describes the version of Thanos to use.</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>tag</td>
<td>Tag of Thanos sidecar container image to be deployed. Defaults to the value of <code>version</code>. Version is ignored if Tag is set.</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>sha</td>
<td>SHA of Thanos container image to be deployed. Defaults to the value of <code>version</code>. Similar to a tag, but the SHA explicitly deploys an immutable container image. Version and Tag are ignored if SHA is set.</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>baseImage</td>
<td>Thanos base image if other than default.</td>
<td>*string</td>
<td>false</td>
</tr>
<tr>
<td>resources</td>
<td>Resources defines the resource requirements for the Thanos sidecar. If not provided, no requests/limits will be set</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#resourcerequirements-v1-core">v1.ResourceRequirements</a></td>
<td>false</td>
</tr>
<tr>
<td>objectStorageConfig</td>
<td>ObjectStorageConfig configures object storage in Thanos.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>listenLocal</td>
<td>ListenLocal makes the Thanos sidecar listen on loopback, so that it does not bind against the Pod IP.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>tracingConfig</td>
<td>TracingConfig configures tracing in Thanos. This is an experimental feature, it may change in any upcoming release in a breaking way.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>grpcServerTlsConfig</td>
<td>GRPCServerTLSConfig configures the gRPC server from which Thanos Querier reads recorded rule data. Note: Currently only the CAFile, CertFile, and KeyFile fields are supported. Maps to the ‘–grpc-server-tls-*’ CLI args.</td>
<td>*<a href="#tlsconfig">TLSConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>logLevel</td>
<td>LogLevel for Thanos sidecar to be configured with.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>logFormat</td>
<td>LogFormat for Thanos sidecar to be configured with.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>minTime</td>
<td>MinTime for Thanos sidecar to be configured with. Option can be a constant time in RFC3339 format or time duration relative to current time, such as -1d or 2h45m. Valid duration units are ms, s, m, h, d, w, y.</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ThanosRuler"><a href="#ThanosRuler" class="headerlink" title="ThanosRuler"></a>ThanosRuler</h2><p>ThanosRuler defines a ThanosRuler deployment.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#objectmeta-v1-meta">metav1.ObjectMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>spec</td>
<td>Specification of the desired behavior of the ThanosRuler cluster. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></td>
<td><a href="#thanosrulerspec">ThanosRulerSpec</a></td>
<td>true</td>
</tr>
<tr>
<td>status</td>
<td>Most recent observed status of the ThanosRuler cluster. Read-only. Not included when requesting from the apiserver, only from the ThanosRuler Operator API itself. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></td>
<td>*<a href="#thanosrulerstatus">ThanosRulerStatus</a></td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ThanosRulerList"><a href="#ThanosRulerList" class="headerlink" title="ThanosRulerList"></a>ThanosRulerList</h2><p>ThanosRulerList is a list of ThanosRulers.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>metadata</td>
<td>Standard list metadata More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata</a></td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#listmeta-v1-meta">metav1.ListMeta</a></td>
<td>false</td>
</tr>
<tr>
<td>items</td>
<td>List of Prometheuses</td>
<td>[]*<a href="#thanosruler">ThanosRuler</a></td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ThanosRulerSpec"><a href="#ThanosRulerSpec" class="headerlink" title="ThanosRulerSpec"></a>ThanosRulerSpec</h2><p>ThanosRulerSpec is a specification of the desired behavior of the ThanosRuler. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>podMetadata</td>
<td>PodMetadata contains Labels and Annotations gets propagated to the thanos ruler pods.</td>
<td>*<a href="#embeddedobjectmetadata">EmbeddedObjectMetadata</a></td>
<td>false</td>
</tr>
<tr>
<td>image</td>
<td>Thanos container image URL.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>imagePullSecrets</td>
<td>An optional list of references to secrets in the same namespace to use for pulling thanos images from registries see <a target="_blank" rel="noopener" href="http://kubernetes.io/docs/user-guide/images#specifying-imagepullsecrets-on-a-pod">http://kubernetes.io/docs/user-guide/images#specifying-imagepullsecrets-on-a-pod</a></td>
<td>[]<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#localobjectreference-v1-core">v1.LocalObjectReference</a></td>
<td>false</td>
</tr>
<tr>
<td>paused</td>
<td>When a ThanosRuler deployment is paused, no actions except for deletion will be performed on the underlying objects.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>replicas</td>
<td>Number of thanos ruler instances to deploy.</td>
<td>*int32</td>
<td>false</td>
</tr>
<tr>
<td>nodeSelector</td>
<td>Define which Nodes the Pods are scheduled on.</td>
<td>map[string]string</td>
<td>false</td>
</tr>
<tr>
<td>resources</td>
<td>Resources defines the resource requirements for single Pods. If not provided, no requests/limits will be set</td>
<td><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#resourcerequirements-v1-core">v1.ResourceRequirements</a></td>
<td>false</td>
</tr>
<tr>
<td>affinity</td>
<td>If specified, the pod’s scheduling constraints.</td>
<td>*v1.Affinity</td>
<td>false</td>
</tr>
<tr>
<td>tolerations</td>
<td>If specified, the pod’s tolerations.</td>
<td>[]v1.Toleration</td>
<td>false</td>
</tr>
<tr>
<td>securityContext</td>
<td>SecurityContext holds pod-level security attributes and common container settings. This defaults to the default PodSecurityContext.</td>
<td>*v1.PodSecurityContext</td>
<td>false</td>
</tr>
<tr>
<td>priorityClassName</td>
<td>Priority class assigned to the Pods</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>serviceAccountName</td>
<td>ServiceAccountName is the name of the ServiceAccount to use to run the Thanos Ruler Pods.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>storage</td>
<td>Storage spec to specify how storage shall be used.</td>
<td>*<a href="#storagespec">StorageSpec</a></td>
<td>false</td>
</tr>
<tr>
<td>volumes</td>
<td>Volumes allows configuration of additional volumes on the output StatefulSet definition. Volumes specified will be appended to other volumes that are generated as a result of StorageSpec objects.</td>
<td>[]v1.Volume</td>
<td>false</td>
</tr>
<tr>
<td>objectStorageConfig</td>
<td>ObjectStorageConfig configures object storage in Thanos.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>listenLocal</td>
<td>ListenLocal makes the Thanos ruler listen on loopback, so that it does not bind against the Pod IP.</td>
<td>bool</td>
<td>false</td>
</tr>
<tr>
<td>queryEndpoints</td>
<td>QueryEndpoints defines Thanos querier endpoints from which to query metrics. Maps to the –query flag of thanos ruler.</td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>queryConfig</td>
<td>Define configuration for connecting to thanos query instances. If this is defined, the QueryEndpoints field will be ignored. Maps to the <code>query.config</code> CLI argument. Only available with thanos v0.11.0 and higher.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>alertmanagersUrl</td>
<td>Define URLs to send alerts to Alertmanager.  For Thanos v0.10.0 and higher, AlertManagersConfig should be used instead.  Note: this field will be ignored if AlertManagersConfig is specified. Maps to the <code>alertmanagers.url</code> arg.</td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>alertmanagersConfig</td>
<td>Define configuration for connecting to alertmanager.  Only available with thanos v0.10.0 and higher.  Maps to the <code>alertmanagers.config</code> arg.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>ruleSelector</td>
<td>A label selector to select which PrometheusRules to mount for alerting and recording.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>ruleNamespaceSelector</td>
<td>Namespaces to be selected for Rules discovery. If unspecified, only the same namespace as the ThanosRuler object is in is used.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#labelselector-v1-meta">metav1.LabelSelector</a></td>
<td>false</td>
</tr>
<tr>
<td>enforcedNamespaceLabel</td>
<td>EnforcedNamespaceLabel enforces adding a namespace label of origin for each alert and metric that is user created. The label value will always be the namespace of the object that is being created.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>prometheusRulesExcludedFromEnforce</td>
<td>PrometheusRulesExcludedFromEnforce - list of Prometheus rules to be excluded from enforcing of adding namespace labels. Works only if enforcedNamespaceLabel set to true. Make sure both ruleNamespace and ruleName are set for each pair</td>
<td>[]<a href="#prometheusruleexcludeconfig">PrometheusRuleExcludeConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>logLevel</td>
<td>Log level for ThanosRuler to be configured with.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>logFormat</td>
<td>Log format for ThanosRuler to be configured with.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>portName</td>
<td>Port name used for the pods and governing service. This defaults to web</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>evaluationInterval</td>
<td>Interval between consecutive evaluations.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>retention</td>
<td>Time duration ThanosRuler shall retain data for. Default is ‘24h’, and must match the regular expression <code>[0-9]+(ms|s|m|h|d|w|y)</code> (milliseconds seconds minutes hours days weeks years).</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>containers</td>
<td>Containers allows injecting additional containers or modifying operator generated containers. This can be used to allow adding an authentication proxy to a ThanosRuler pod or to change the behavior of an operator generated container. Containers described here modify an operator generated container if they share the same name and modifications are done via a strategic merge patch. The current container names are: <code>thanos-ruler</code> and <code>rules-configmap-reloader</code>. Overriding containers is entirely outside the scope of what the maintainers will support and by doing so, you accept that this behaviour may break at any time without notice.</td>
<td>[]v1.Container</td>
<td>false</td>
</tr>
<tr>
<td>initContainers</td>
<td>InitContainers allows adding initContainers to the pod definition. Those can be used to e.g. fetch secrets for injection into the ThanosRuler configuration from external sources. Any errors during the execution of an initContainer will lead to a restart of the Pod. More info: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">https://kubernetes.io/docs/concepts/workloads/pods/init-containers/</a> Using initContainers for any use case other then secret fetching is entirely outside the scope of what the maintainers will support and by doing so, you accept that this behaviour may break at any time without notice.</td>
<td>[]v1.Container</td>
<td>false</td>
</tr>
<tr>
<td>tracingConfig</td>
<td>TracingConfig configures tracing in Thanos. This is an experimental feature, it may change in any upcoming release in a breaking way.</td>
<td>*<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.17/#secretkeyselector-v1-core">v1.SecretKeySelector</a></td>
<td>false</td>
</tr>
<tr>
<td>labels</td>
<td>Labels configure the external label pairs to ThanosRuler. If not provided, default replica label <code>thanos_ruler_replica</code> will be added as a label and be dropped in alerts.</td>
<td>map[string]string</td>
<td>false</td>
</tr>
<tr>
<td>alertDropLabels</td>
<td>AlertDropLabels configure the label names which should be dropped in ThanosRuler alerts. If <code>labels</code> field is not provided, <code>thanos_ruler_replica</code> will be dropped in alerts by default.</td>
<td>[]string</td>
<td>false</td>
</tr>
<tr>
<td>externalPrefix</td>
<td>The external URL the Thanos Ruler instances will be available under. This is necessary to generate correct URLs. This is necessary if Thanos Ruler is not served from root of a DNS name.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>routePrefix</td>
<td>The route prefix ThanosRuler registers HTTP handlers for. This allows thanos UI to be served on a sub-path.</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>grpcServerTlsConfig</td>
<td>GRPCServerTLSConfig configures the gRPC server from which Thanos Querier reads recorded rule data. Note: Currently only the CAFile, CertFile, and KeyFile fields are supported. Maps to the ‘–grpc-server-tls-*’ CLI args.</td>
<td>*<a href="#tlsconfig">TLSConfig</a></td>
<td>false</td>
</tr>
<tr>
<td>alertQueryUrl</td>
<td>The external Query URL the Thanos Ruler will set in the ‘Source’ field of all alerts. Maps to the ‘–alert.query-url’ CLI arg.</td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
<h2 id="ThanosRulerStatus"><a href="#ThanosRulerStatus" class="headerlink" title="ThanosRulerStatus"></a>ThanosRulerStatus</h2><p>ThanosRulerStatus is the most recent observed status of the ThanosRuler. Read-only. Not included when requesting from the apiserver, only from the Prometheus Operator API itself. More info: <a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status">https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Scheme</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td>paused</td>
<td>Represents whether any actions on the underlying managed objects are being performed. Only delete actions will be performed.</td>
<td>bool</td>
<td>true</td>
</tr>
<tr>
<td>replicas</td>
<td>Total number of non-terminated pods targeted by this ThanosRuler deployment (their labels match the selector).</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>updatedReplicas</td>
<td>Total number of non-terminated pods targeted by this ThanosRuler deployment that have the desired version spec.</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>availableReplicas</td>
<td>Total number of available pods (ready for at least minReadySeconds) targeted by this ThanosRuler deployment.</td>
<td>int32</td>
<td>true</td>
</tr>
<tr>
<td>unavailableReplicas</td>
<td>Total number of unavailable pods targeted by this ThanosRuler deployment.</td>
<td>int32</td>
<td>true</td>
</tr>
</tbody></table>
<p><a href="#table-of-contents">Back to TOC</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/Documentation/additional-scrape-config"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/Documentation/additional-scrape-config/" class="article-date">
  <time datetime="2020-12-12T13:30:47.137Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Additional-Scrape-Configuration"><a href="#Additional-Scrape-Configuration" class="headerlink" title="Additional Scrape Configuration"></a>Additional Scrape Configuration</h1><p>AdditionalScrapeConfigs allows specifying a key of a Secret containing<br>additional Prometheus scrape configurations. Scrape configurations specified<br>are appended to the configurations generated by the Prometheus Operator.</p>
<p>Job configurations specified must have the form as specified in the official<br><a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config">Prometheus documentation</a>.<br>As scrape configs are appended, the user is responsible to make sure it is<br>valid. <em>Note</em> that using this feature may expose the possibility to break<br>upgrades of Prometheus.</p>
<p>It is advised to review Prometheus release notes to ensure that no incompatible<br>scrape configs are going to break Prometheus after the upgrade.</p>
<h2 id="Creating-an-additional-configuration"><a href="#Creating-an-additional-configuration" class="headerlink" title="Creating an additional configuration"></a>Creating an additional configuration</h2><p>First, you will need to create the additional configuration.<br>Below we are making a simple “prometheus” config.  Name this<br><code>prometheus-additional.yaml</code> or something similar.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- job_name: &quot;prometheus&quot;</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets: [&quot;localhost:9090&quot;]</span><br></pre></td></tr></table></figure>

<p>Then you will need to make a secret out of this configuration.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic additional-scrape-configs --from-file&#x3D;prometheus-additional.yaml --dry-run -oyaml &gt; additional-scrape-configs.yaml</span><br></pre></td></tr></table></figure>

<p>Next, create a new secret using the base64 encoded output as the value for<br><code>prometheus-additional.yaml</code> in the secret.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  prometheus-additional.yaml: LSBqb2JfbmFtZTogInByb21ldGhldXMiCiAgc3RhdGljX2NvbmZpZ3M6CiAgLSB0YXJnZXRzOiBbImxvY2FsaG9zdDo5MDkwIl0K</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  name: additional-scrape-configs</span><br></pre></td></tr></table></figure>

<p>Finally, reference this additional configuration in your <code>prometheus.yaml</code> CRD.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: monitoring.coreos.com&#x2F;v1</span><br><span class="line">kind: Prometheus</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus</span><br><span class="line">  labels:</span><br><span class="line">    prometheus: prometheus</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  serviceAccountName: prometheus</span><br><span class="line">  serviceMonitorSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      team: frontend</span><br><span class="line">  additionalScrapeConfigs:</span><br><span class="line">    name: additional-scrape-configs</span><br><span class="line">    key: prometheus-additional.yaml</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>NOTE: Use only one secret for ALL additional scrape configurations.</p>
<h2 id="Additional-References"><a href="#Additional-References" class="headerlink" title="Additional References"></a>Additional References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/coreos/prometheus-operator/blob/master/Documentation/api.md#prometheusspec">Prometheus Spec</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/coreos/prometheus-operator/tree/master/example/additional-scrape-configs">Additional Scrape Configs</a></li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/contrib/kube-prometheus/README"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/contrib/kube-prometheus/README/" class="article-date">
  <time datetime="2020-12-12T13:30:47.120Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="kube-prometheus"><a href="#kube-prometheus" class="headerlink" title="kube-prometheus"></a>kube-prometheus</h1><h2 id="WARNING-kube-prometheus-moved-to-coreos-kube-prometheus"><a href="#WARNING-kube-prometheus-moved-to-coreos-kube-prometheus" class="headerlink" title="WARNING: kube-prometheus moved to coreos/kube-prometheus!"></a>WARNING: kube-prometheus moved to <a target="_blank" rel="noopener" href="https://github.com/coreos/kube-prometheus">coreos/kube-prometheus</a>!</h2><p><strong>Why did you move it?</strong></p>
<p>Even though kube-prometheus is an entirely different project, it was part of the Prometheus Operator repository for the last two years.<br>Moving kube-prometheus into its own repository is going to allow us to move more independently from the Prometheus Operator.<br>As an example, we are now going to publish versioned kube-prometheus releases, something that was not possible before.</p>
<p>Take a look at this issue for more information:<br><a target="_blank" rel="noopener" href="https://github.com/coreos/prometheus-operator/issues/2553">https://github.com/coreos/prometheus-operator/issues/2553</a></p>
<p><strong>What do I need to do?</strong></p>
<p>Simply go to <a target="_blank" rel="noopener" href="https://github.com/coreos/kube-prometheus">coreos/kube-prometheus</a> and make use of it the same way you did before.</p>
<p>Users depending on kube-prometheus with jsonnet-bundler, should change this their <code>jsonnetfile.json</code> and <code>jsonnetfile.lock.json</code> to point to the correct repository.</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">             &quot;name&quot;: &quot;kube-prometheus&quot;,</span><br><span class="line">             &quot;source&quot;: &#123;</span><br><span class="line">                 &quot;git&quot;: &#123;</span><br><span class="line"><span class="deletion">-                    &quot;remote&quot;: &quot;https://github.com/coreos/prometheus-operator&quot;,</span></span><br><span class="line"><span class="deletion">-                    &quot;subdir&quot;: &quot;contrib/kube-prometheus/jsonnet/kube-prometheus&quot;</span></span><br><span class="line"><span class="addition">+                    &quot;remote&quot;: &quot;https://github.com/coreos/kube-prometheus&quot;,</span></span><br><span class="line"><span class="addition">+                    &quot;subdir&quot;: &quot;jsonnet/kube-prometheus&quot;</span></span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;,</span><br><span class="line">             &quot;version&quot;: &quot;master&quot;</span><br></pre></td></tr></table></figure>

<p><em>Note: We needed to merge the two repositories and commit hashes are not the same anymore, when referencing coreos/kube-prometheus.</em></p>
<p><strong>You still have questions why it moved?</strong></p>
<p>Feel free to either create an issue or ask in #prometheus-operator on <a target="_blank" rel="noopener" href="http://slack.k8s.io/">Kubernetes Slack</a>.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/RELEASE"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/RELEASE/" class="article-date">
  <time datetime="2020-12-12T13:30:46.217Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Release-schedule"><a href="#Release-schedule" class="headerlink" title="Release schedule"></a>Release schedule</h1><p>Following <a target="_blank" rel="noopener" href="https://github.com/prometheus/prometheus/blob/master/RELEASE.md">Prometheus</a> and <a target="_blank" rel="noopener" href="https://github.com/thanos-io/thanos/blob/master/docs/release-process.md">Thanos</a>, this project aims for a predictible release schedule.</p>
<p>Release cadence of first pre-releases being cut is 6 weeks.</p>
<table>
<thead>
<tr>
<th>Release</th>
<th>Date of first pre-release (year-month-day)</th>
<th>Release shepherd</th>
</tr>
</thead>
<tbody><tr>
<td>v0.39</td>
<td>2020-05-06</td>
<td>Pawel Krupa (GitHub: @paulfantom)</td>
</tr>
<tr>
<td>v0.40</td>
<td>2020-06-17</td>
<td>Lili Cosic (GitHub: @lilic)</td>
</tr>
<tr>
<td>v0.41</td>
<td>2020-07-29</td>
<td><strong>searching for volunteer</strong></td>
</tr>
</tbody></table>
<h1 id="How-to-cut-a-new-release"><a href="#How-to-cut-a-new-release" class="headerlink" title="How to cut a new release"></a>How to cut a new release</h1><blockquote>
<p>This guide is strongly based on the <a target="_blank" rel="noopener" href="https://github.com/prometheus/prometheus/wiki/HOWTO-cut-a-new-release">Prometheus release instructions</a>.</p>
</blockquote>
<h2 id="Branch-management-and-versioning-strategy"><a href="#Branch-management-and-versioning-strategy" class="headerlink" title="Branch management and versioning strategy"></a>Branch management and versioning strategy</h2><p>We use <a target="_blank" rel="noopener" href="http://semver.org/">Semantic Versioning</a>.</p>
<p>We maintain a separate branch for each minor release, named <code>release-&lt;major&gt;.&lt;minor&gt;</code>, e.g. <code>release-1.1</code>, <code>release-2.0</code>.</p>
<p>The usual flow is to merge new features and changes into the master branch and to merge bug fixes into the latest release branch. Bug fixes are then merged into master from the latest release branch. The master branch should always contain all commits from the latest release branch.</p>
<p>If a bug fix got accidentally merged into master, cherry-pick commits have to be created in the latest release branch, which then have to be merged back into master. Try to avoid that situation.</p>
<p>Maintaining the release branches for older minor releases happens on a best effort basis.</p>
<h2 id="Prepare-your-release"><a href="#Prepare-your-release" class="headerlink" title="Prepare your release"></a>Prepare your release</h2><p>For a patch release, work in the branch of the minor release you want to patch.</p>
<p>For a new major or minor release, create the corresponding release branch based on the master branch.</p>
<p>Bump the version in the <code>VERSION</code> file in the root of the repository. Once that’s done, a number of files have to be re-generated, this is automated with the following make target:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make generate</span><br></pre></td></tr></table></figure>

<p>Now that all version information has been updated, an entry for the new version can be added to the <code>CHANGELOG.md</code> file.</p>
<p>Entries in the <code>CHANGELOG.md</code> are meant to be in this order:</p>
<ul>
<li><code>[CHANGE]</code></li>
<li><code>[FEATURE]</code></li>
<li><code>[ENHANCEMENT]</code></li>
<li><code>[BUGFIX]</code></li>
</ul>
<p>Create a PR for the version and changelog changes to be reviewed.</p>
<h2 id="Draft-the-new-release"><a href="#Draft-the-new-release" class="headerlink" title="Draft the new release"></a>Draft the new release</h2><p>Once the PR for the new release has been merged, make sure there is a release branch for the respective release. For new minor releases create the <code>release-&lt;major&gt;.&lt;minor&gt;</code> branch, for patch releases, merge  the master branch into the existing release branch. Should the release be a patch release for an older minor release, cherry-pick the respective changes.</p>
<p>Push the new or updated release branch to the upstream repository.</p>
<p>Tag the new release with a tag named <code>v&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</code>, e.g. <code>v2.1.3</code>. Note the <code>v</code> prefix.</p>
<p>You can do the tagging on the commandline:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tag=$(&lt; VERSION) &amp;&amp; git tag -s <span class="string">&quot;v<span class="variable">$&#123;tag&#125;</span>&quot;</span> -m <span class="string">&quot;v<span class="variable">$&#123;tag&#125;</span>&quot;</span></span><br><span class="line">$ git push origin <span class="string">&quot;v<span class="variable">$&#123;tag&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>Signed tag with a GPG key is appreciated, but in case you can’t add a GPG key to your Github account using the following <a target="_blank" rel="noopener" href="https://help.github.com/articles/generating-a-gpg-key/">procedure</a>, you can replace the <code>-s</code> flag by <code>-a</code> flag of the <code>git tag</code> command to only annotate the tag without signing.</p>
<p>Our CI pipeline will automatically push a new docker image to quay.io.</p>
<p>Go to  <a target="_blank" rel="noopener" href="https://github.com/coreos/prometheus-operator/releases/new">https://github.com/coreos/prometheus-operator/releases/new</a>, associate the new release with the before pushed tag, paste in changes made to <code>CHANGELOG.md</code> and click “Publish release”.</p>
<p>Take a breath. You’re done releasing.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/README"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/README/" class="article-date">
  <time datetime="2020-12-12T13:30:46.211Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Prometheus-Operator"><a href="#Prometheus-Operator" class="headerlink" title="Prometheus Operator"></a>Prometheus Operator</h1><p><a target="_blank" rel="noopener" href="https://travis-ci.org/coreos/prometheus-operator"><img src="https://travis-ci.org/coreos/prometheus-operator.svg?branch=master" alt="Build Status"></a><br><a target="_blank" rel="noopener" href="https://goreportcard.com/report/coreos/prometheus-operator"><img src="https://goreportcard.com/badge/coreos/prometheus-operator" alt="Go Report Card" title="Go Report Card"></a><br><a target="_blank" rel="noopener" href="http://slack.k8s.io/"><img src="https://img.shields.io/badge/join%20slack-%23prometheus--operator-brightgreen.svg" alt="Slack"></a></p>
<p><strong>Project status: <em>beta</em></strong> Not all planned features are completed. The API, spec, status and other user facing objects may change, but in a backward compatible way.</p>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>The Prometheus Operator provides <a target="_blank" rel="noopener" href="https://kubernetes.io/">Kubernetes</a> native deployment and management of<br><a target="_blank" rel="noopener" href="https://prometheus.io/">Prometheus</a> and related monitoring components.  The purpose of this project is to<br>simplify and automate the configuration of a Prometheus based monitoring stack for Kubernetes clusters.</p>
<p>The Prometheus operator includes, but is not limited to, the following features:</p>
<ul>
<li><p><strong>Kubernetes Custom Resources</strong>: Use Kubernetes custom resources to deploy and manage Prometheus, Alertmanager,<br>and related components.</p>
</li>
<li><p><strong>Simplified Deployment Configuration</strong>: Configure the fundamentals of Prometheus like versions, persistence,<br>retention policies, and replicas from a native Kubernetes resource.</p>
</li>
<li><p><strong>Prometheus Target Configuration</strong>: Automatically generate monitoring target configurations based<br>on familiar Kubernetes label queries; no need to learn a Prometheus specific configuration language.</p>
</li>
</ul>
<p>For an introduction to the Prometheus Operator, see the initial <a target="_blank" rel="noopener" href="https://coreos.com/blog/the-prometheus-operator.html">blog<br>post</a>.</p>
<h2 id="Prometheus-Operator-vs-kube-prometheus-vs-community-helm-chart"><a href="#Prometheus-Operator-vs-kube-prometheus-vs-community-helm-chart" class="headerlink" title="Prometheus Operator vs. kube-prometheus vs. community helm chart"></a>Prometheus Operator vs. kube-prometheus vs. community helm chart</h2><p>The Prometheus Operator uses Kubernetes <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom resources</a> to simplifiy the deployment and configuration of Prometheus, Alertmanager, and related monitoring components.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/coreos/kube-prometheus">kube-prometheus</a> provides example configurations for a complete cluster monitoring<br>stack based on Prometheus and the Prometheus Operator.  This includes deployment of multiple Prometheus and Alertmanager instances,<br>metrics exporters such as the node_exporter for gathering node metrics, scrape target configuration linking Prometheus to various<br>metrics endpoints, and example alerting rules for notification of potential issues in the cluster.</p>
<p>The <a target="_blank" rel="noopener" href="https://github.com/helm/charts/tree/master/stable/prometheus-operator">stable/prometheus-operator</a><br>helm chart provides a similar feature set to kube-prometheus. This chart is maintained by the Helm community.<br>For more information, please see the <a target="_blank" rel="noopener" href="https://github.com/helm/charts/tree/master/stable/prometheus-operator#prometheus-operator">chart’s readme</a></p>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>Version <code>&gt;=0.39.0</code> of the Prometheus Operator requires a Kubernetes<br>cluster of version <code>&gt;=1.16.0</code>. If you are just starting out with the<br>Prometheus Operator, it is highly recommended to use the latest version.</p>
<p>If you have an older version of Kubernetes and the Prometheus Operator running,<br>we recommend upgrading Kubernetes first and then the Prometheus Operator.</p>
<h2 id="CustomResourceDefinitions"><a href="#CustomResourceDefinitions" class="headerlink" title="CustomResourceDefinitions"></a>CustomResourceDefinitions</h2><p>A core feature of the Prometheus Operator is to monitor the Kubernetes API server for changes<br>to specific objects and ensure that the current Prometheus deployments match these objects.<br>The Operator acts on the following <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/access-kubernetes-api/extend-api-custom-resource-definitions/">custom resource definitions (CRDs)</a>:</p>
<ul>
<li><p><strong><code>Prometheus</code></strong>, which defines a desired Prometheus deployment.</p>
</li>
<li><p><strong><code>Alertmanager</code></strong>, which defines a desired Alertmanager deployment.</p>
</li>
<li><p><strong><code>ThanosRuler</code></strong>, which defines a desired Thanos Ruler deployment.</p>
</li>
<li><p><strong><code>ServiceMonitor</code></strong>, which declaratively specifies how groups of Kubernetes services should be monitored.<br>The Operator automatically generates Prometheus scrape configuration based on the current state of the objects in the API server.</p>
</li>
<li><p><strong><code>PodMonitor</code></strong>, which declaratively specifies how group of pods should be monitored.<br>The Operator automatically generates Prometheus scrape configuration based on the current state of the objects in the API server.</p>
</li>
<li><p><strong><code>PrometheusRule</code></strong>, which defines a desired set of Prometheus alerting and/or recording rules.<br>The Operator generates a rule file, which can be used by Prometheus instances.</p>
</li>
</ul>
<p>The Prometheus operator automatically detects changes in the Kubernetes API server to any of the above objects, and ensures that<br>matching deployments and configurations are kept in sync.</p>
<p>To learn more about the CRDs introduced by the Prometheus Operator have a look<br>at the <a href="Documentation/design.md">design doc</a>.</p>
<p>To automate validation of your CRD configuration files see about <a href="Documentation/user-guides/linting.md">linting</a>.</p>
<h2 id="Dynamic-Admission-Control"><a href="#Dynamic-Admission-Control" class="headerlink" title="Dynamic Admission Control"></a>Dynamic Admission Control</h2><p>To prevent invalid Prometheus alerting and recording rules from causing failures in a deployed Prometheus instance,<br>an <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/">admission webhook</a><br>is provided to validate <code>PrometheusRule</code> resources upon initial creation or update.</p>
<p>For more information on this feature, see the <a href="Documentation/user-guides/webhook.md">user guide</a>.</p>
<h2 id="Quickstart"><a href="#Quickstart" class="headerlink" title="Quickstart"></a>Quickstart</h2><p><strong>Note:</strong> this quickstart does not provision an entire monitoring stack; if that is what you are looking for,<br>see the <a target="_blank" rel="noopener" href="https://github.com/coreos/kube-prometheus">kube-prometheus</a> project.  If you want the whole stack,<br>but have already applied the <code>bundle.yaml</code>, delete the bundle first (<code>kubectl delete -f bundle.yaml</code>).</p>
<p>To quickly try out <em>just</em> the Prometheus Operator inside a cluster, <strong>choose a release</strong> and run the following command:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f bundle.yaml</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note: make sure to adapt the namespace in the ClusterRoleBinding if deploying in a namespace other than the default namespace.</p>
</blockquote>
<p>To run the Operator outside of a cluster:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">scripts/run-external.sh &lt;kubectl cluster name&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Removal"><a href="#Removal" class="headerlink" title="Removal"></a>Removal</h2><p>To remove the operator and Prometheus, first delete any custom resources you created in each namespace. The<br>operator will automatically shut down and remove Prometheus and Alertmanager pods, and associated ConfigMaps.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> $(kubectl get namespaces -o jsonpath=&#123;..metadata.name&#125;); <span class="keyword">do</span></span><br><span class="line">  kubectl delete --all --namespace=<span class="variable">$n</span> prometheus,servicemonitor,podmonitor,alertmanager</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>After a couple of minutes you can go ahead and remove the operator itself.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f bundle.yaml</span><br></pre></td></tr></table></figure>

<p>The operator automatically creates services in each namespace where you created a Prometheus or Alertmanager resources,<br>and defines three custom resource definitions. You can clean these up now.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> $(kubectl get namespaces -o jsonpath=&#123;..metadata.name&#125;); <span class="keyword">do</span></span><br><span class="line">  kubectl delete --ignore-not-found --namespace=<span class="variable">$n</span> service prometheus-operated alertmanager-operated</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">kubectl delete --ignore-not-found customresourcedefinitions \</span><br><span class="line">  prometheuses.monitoring.coreos.com \</span><br><span class="line">  servicemonitors.monitoring.coreos.com \</span><br><span class="line">  podmonitors.monitoring.coreos.com \</span><br><span class="line">  alertmanagers.monitoring.coreos.com \</span><br><span class="line">  prometheusrules.monitoring.coreos.com</span><br></pre></td></tr></table></figure>

<h2 id="Development"><a href="#Development" class="headerlink" title="Development"></a>Development</h2><h3 id="Prerequisites-1"><a href="#Prerequisites-1" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><ul>
<li>golang environment</li>
<li>docker (used for creating container images, etc.)</li>
<li>minikube (optional)</li>
</ul>
<h3 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h3><blockquote>
<p>Ensure that you’re running tests in the following path:<br><code>$GOPATH/src/github.com/coreos/prometheus-operator</code> as tests expect paths to<br>match. If you’re working from a fork, just add the forked repo as a remote and<br>pull against your local coreos checkout before running tests.</p>
</blockquote>
<h4 id="Running-unit-tests"><a href="#Running-unit-tests" class="headerlink" title="Running unit tests:"></a>Running <em>unit tests</em>:</h4><p><code>make test-unit</code></p>
<h4 id="Running-end-to-end-tests-on-local-minikube-cluster"><a href="#Running-end-to-end-tests-on-local-minikube-cluster" class="headerlink" title="Running end-to-end tests on local minikube cluster:"></a>Running <em>end-to-end</em> tests on local minikube cluster:</h4><ol>
<li><code>minikube start --kubernetes-version=v1.10.0 --memory=4096  --extra-config=apiserver.authorization-mode=RBAC</code></li>
<li><code>eval $(minikube docker-env) &amp;&amp; make image</code> - build Prometheus Operator<br> docker image on minikube’s docker</li>
<li><code>make test-e2e</code></li>
</ol>
<h4 id="Running-end-to-end-tests-on-local-kind-cluster"><a href="#Running-end-to-end-tests-on-local-kind-cluster" class="headerlink" title="Running end-to-end tests on local kind cluster:"></a>Running <em>end-to-end</em> tests on local kind cluster:</h4><ol>
<li><code>kind create cluster --image=kindest/node:&lt;latest&gt;</code>. e.g <code>v1.16.2</code> version. </li>
<li><code>export KUBECONFIG=&quot;$(kind get kubeconfig-path --name=&quot;kind&quot;)&quot;</code></li>
<li><code>make image</code> - build Prometheus Operator  docker image locally.</li>
<li><code>for n in &quot;operator&quot; &quot;config-reloader&quot;; do kind load docker-image &quot;quay.io/coreos/prometheus-$n:$(git rev-parse --short HEAD)&quot;; done</code> - publish<br>built locally images to be accessible inside kind. </li>
<li><code>make test-e2e</code></li>
</ol>
<h2 id="Contributing"><a href="#Contributing" class="headerlink" title="Contributing"></a>Contributing</h2><p>Many files (documentation, manifests, …) in this repository are<br>auto-generated. E.g. <code>bundle.yaml</code> originates from the <em>Jsonnet</em> files in<br><code>/jsonnet/prometheus-operator</code>. Before proposing a pull request:</p>
<ol>
<li>Commit your changes.</li>
<li>Run <code>make generate</code>.</li>
<li>Commit the generated changes.</li>
</ol>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><p>If you find a security vulnerability related to the Prometheus Operator, please<br>do not report it by opening a GitHub issue, but instead please send an e-mail to<br>the maintainers of the project found in the <a href="OWNERS">OWNERS</a> file.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-prometheus-operator/CONTRIBUTING"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2020/12/12/prometheus-operator/CONTRIBUTING/" class="article-date">
  <time datetime="2020-12-12T13:30:46.122Z" itemprop="datePublished">2020-12-12</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="How-to-Contribute"><a href="#How-to-Contribute" class="headerlink" title="How to Contribute"></a>How to Contribute</h1><p>CoreOS projects are <a href="LICENSE">Apache 2.0 licensed</a> and accept contributions via<br>GitHub pull requests.  This document outlines some of the conventions on<br>development workflow, commit message formatting, contact points and other<br>resources to make it easier to get your contribution accepted.</p>
<h1 id="Certificate-of-Origin"><a href="#Certificate-of-Origin" class="headerlink" title="Certificate of Origin"></a>Certificate of Origin</h1><p>By contributing to this project you agree to the Developer Certificate of<br>Origin (DCO). This document was created by the Linux Kernel community and is a<br>simple statement that you, as a contributor, have the legal right to make the<br>contribution. See the <a href="DCO">DCO</a> file for details.</p>
<h1 id="Email-and-Chat"><a href="#Email-and-Chat" class="headerlink" title="Email and Chat"></a>Email and Chat</h1><p>The project currently uses the general CoreOS email list and IRC channel:</p>
<ul>
<li>Email: <a target="_blank" rel="noopener" href="https://groups.google.com/forum/#!forum/coreos-dev">coreos-dev</a></li>
<li>IRC: #<a href="irc://irc.freenode.org:6667/#coreos">coreos</a> IRC channel on freenode.org</li>
</ul>
<p>Please avoid emailing maintainers found in the MAINTAINERS file directly. They<br>are very busy and read the mailing lists.</p>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><ul>
<li>Fork the repository on GitHub</li>
<li>Read the <a href="README.md">README</a> for build and test instructions</li>
<li>Play with the project, submit bugs, submit patches!</li>
</ul>
<h2 id="Contribution-Flow"><a href="#Contribution-Flow" class="headerlink" title="Contribution Flow"></a>Contribution Flow</h2><p>This is a rough outline of what a contributor’s workflow looks like:</p>
<ul>
<li>Create a topic branch from where you want to base your work (usually master).</li>
<li>Make commits of logical units.</li>
<li>Make sure your commit messages are in the proper format (see below).</li>
<li>Push your changes to a topic branch in your fork of the repository.</li>
<li>Make sure the tests pass, and add any new tests as appropriate.</li>
<li>Submit a pull request to the original repository.</li>
</ul>
<p>Thanks for your contributions!</p>
<h3 id="Coding-Style"><a href="#Coding-Style" class="headerlink" title="Coding Style"></a>Coding Style</h3><p>CoreOS projects written in Go follow a set of style guidelines that we’ve documented<br><a target="_blank" rel="noopener" href="https://github.com/coreos/docs/tree/master/golang">here</a>. Please follow them when<br>working on your contributions.</p>
<h3 id="Format-of-the-Commit-Message"><a href="#Format-of-the-Commit-Message" class="headerlink" title="Format of the Commit Message"></a>Format of the Commit Message</h3><p>We follow a rough convention for commit messages that is designed to answer two<br>questions: what changed and why. The subject line should feature the what and<br>the body of the commit should describe the why.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scripts: add the test-cluster command</span><br><span class="line"></span><br><span class="line">this uses tmux to setup a test cluster that you can easily kill and</span><br><span class="line">start for debugging.</span><br><span class="line"></span><br><span class="line">Fixes #38</span><br></pre></td></tr></table></figure>

<p>The format can be described more formally as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;subsystem&gt;: &lt;what changed&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;why this change was made&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure>

<p>The first line is the subject and should be no longer than 70 characters, the<br>second line is always blank, and other lines should be wrapped at 80 characters.<br>This allows the message to be easier to read on GitHub as well as in various<br>git tools.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

    
 
   
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2020
        <i class="ri-heart-fill heart_icon"></i> Nero
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/logo.png" alt="Nero 的个人博客"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->


<script src="/js/clickBoom2.js"></script>


<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


<script src="/js/dz.js"></script>



    
  </div>
</body>

</html>