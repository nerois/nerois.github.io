<h1 id="RBAC-for-Prometheus-Operator-CRDs"><a href="#RBAC-for-Prometheus-Operator-CRDs" class="headerlink" title="RBAC for Prometheus Operator CRDs"></a>RBAC for Prometheus Operator CRDs</h1><h2 id="Aggregated-ClusterRoles"><a href="#Aggregated-ClusterRoles" class="headerlink" title="Aggregated ClusterRoles"></a>Aggregated ClusterRoles</h2><p>It can be useful to aggregate permissions on the Prometheus Operator CustomResourceDefinitions to the default user-facing roles, like <code>view</code>, <code>edit</code> and <code>admin</code>.</p>
<p>This can be achieved using ClusterRole aggregation. This lets admins include rules for custom resources, such as those served by CustomResourceDefinitions or Aggregated API servers, on the default roles.</p>
<blockquote>
<p>Note: ClusterRole aggregation is available starting Kubernetes 1.9. </p>
</blockquote>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>In order to aggregate <em>read</em> (resp. <em>edit</em>) permissions for the Prometheus Operator CustomResourceDefinitions to the <code>view</code> (resp. <code>edit</code> / <code>admin</code>) role(s), a cluster admin can create the <code>ClusterRole</code>s below.</p>
<p>This grants:</p>
<ul>
<li>Users with <code>view</code> role permissions to view the Prometheus Operator CRDs within their namespaces,</li>
<li>Users with <code>edit</code> and <code>admin</code> roles permissions to create, edit and delete Prometheus Operator CRDs within their namespaces.</li>
</ul>
<pre><code class="yaml">kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: prometheus-crd-view
  labels:
    rbac.authorization.k8s.io/aggregate-to-admin: &quot;true&quot;
    rbac.authorization.k8s.io/aggregate-to-edit: &quot;true&quot;
    rbac.authorization.k8s.io/aggregate-to-view: &quot;true&quot;
rules:
- apiGroups: [&quot;monitoring.coreos.com&quot;]
  resources: [&quot;alertmanagers&quot;, &quot;prometheuses&quot;, &quot;prometheusrules&quot;, &quot;servicemonitors&quot;, &quot;podmonitors&quot;]
  verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: prometheus-crd-edit
  labels:
    rbac.authorization.k8s.io/aggregate-to-edit: &quot;true&quot;
    rbac.authorization.k8s.io/aggregate-to-admin: &quot;true&quot;
rules:
- apiGroups: [&quot;monitoring.coreos.com&quot;]
  resources: [&quot;alertmanagers&quot;, &quot;prometheuses&quot;, &quot;prometheusrules&quot;, &quot;servicemonitors&quot;, &quot;podmonitors&quot;]
  verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;]</code></pre>
