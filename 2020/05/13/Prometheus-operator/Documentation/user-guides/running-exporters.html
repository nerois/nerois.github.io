<br>
<div class="alert alert-info" role="alert">
    <i class="fa fa-exclamation-triangle"></i><b> Note:</b> Starting with v0.12.0, Prometheus Operator requires use of Kubernetes v1.7.x and up.
</div>

<h1 id="Running-Exporters"><a href="#Running-Exporters" class="headerlink" title="Running Exporters"></a>Running Exporters</h1><p>Running exporters and scraping them with Prometheus configured by the prometheus-operator.</p>
<h2 id="The-goal-of-ServiceMonitor-s"><a href="#The-goal-of-ServiceMonitor-s" class="headerlink" title="The goal of ServiceMonitor(s)"></a>The goal of ServiceMonitor(s)</h2><p>The goal for one ServiceMonitor should be to cover a large number of Services. This can be achieved by creating a generic <code>ServiceMonitor</code>.</p>
<h2 id="Create-a-service-that-exposes-Pod-s"><a href="#Create-a-service-that-exposes-Pod-s" class="headerlink" title="Create a service that exposes Pod(s)"></a>Create a service that exposes Pod(s)</h2><p>Scraping an exporter or separate metrics port requires a service that targets the Pod(s) of the exporter or application.</p>
<p>The following examples create a Service for the <code>kube-state-metrics</code>, and a generic ServiceMonitor which may be used for more than simply the <code>kube-state-metrics</code> Service.</p>
<p>The order in which the <code>Service</code> and <code>ServiceMonitor</code> is created is not important.</p>
<h3 id="kube-state-metrics-Service-example"><a href="#kube-state-metrics-Service-example" class="headerlink" title="kube-state-metrics Service example"></a>kube-state-metrics Service example</h3><pre><code>apiVersion: v1
kind: Service
metadata:
  labels:
    app: kube-state-metrics
    k8s-app: kube-state-metrics
  annotations:
    alpha.monitoring.coreos.com/non-namespaced: &quot;true&quot;
  name: kube-state-metrics
spec:
  ports:
  - name: http-metrics
    port: 8080
    targetPort: metrics
    protocol: TCP
  selector:
    app: kube-state-metrics</code></pre>
<p>This Service targets all Pods with the label <code>k8s-app: kube-state-metrics</code>.</p>
<h3 id="Generic-ServiceMonitor-example"><a href="#Generic-ServiceMonitor-example" class="headerlink" title="Generic ServiceMonitor example"></a>Generic ServiceMonitor example</h3><p>This ServiceMonitor targets <strong>all</strong> Services with the label <code>k8s-app</code> (<code>spec.selector</code>) any value, in the namespaces <code>kube-system</code> and <code>monitoring</code> (<code>spec.namespaceSelector</code>).</p>
<pre><code>apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: k8s-apps-http
  labels:
    k8s-apps: http
spec:
  jobLabel: k8s-app
  selector:
    matchExpressions:
    - {key: k8s-app, operator: Exists}
  namespaceSelector:
    matchNames:
    - kube-system
    - monitoring
  endpoints:
  - port: http-metrics
    interval: 15s</code></pre>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><h3 id="Namespace-“limits”-things-to-keep-in-mind"><a href="#Namespace-“limits”-things-to-keep-in-mind" class="headerlink" title="Namespace “limits”/things to keep in mind"></a>Namespace “limits”/things to keep in mind</h3><p>See the ServiceMonitor Documentation:</p>
<blockquote>
<p>While <code>ServiceMonitors</code> must live in the same namespace as the Prometheus<br>resource, discovered targets may come from any namespace. This allows<br>cross-namespace monitoring use cases, for example, for meta-monitoring. Use the<br><code>namespaceSelector</code> of the <code>ServiceMonitorSpec</code> to restrict the<br>namespaces from which Endpoints objects may be discovered.</p>
</blockquote>
