<h1 id="Additional-Scrape-Configuration"><a href="#Additional-Scrape-Configuration" class="headerlink" title="Additional Scrape Configuration"></a>Additional Scrape Configuration</h1><p>AdditionalScrapeConfigs allows specifying a key of a Secret containing<br>additional Prometheus scrape configurations. Scrape configurations specified<br>are appended to the configurations generated by the Prometheus Operator.</p>
<p>Job configurations specified must have the form as specified in the official<br><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config">Prometheus documentation</a>.<br>As scrape configs are appended, the user is responsible to make sure it is<br>valid. <em>Note</em> that using this feature may expose the possibility to break<br>upgrades of Prometheus.</p>
<p>It is advised to review Prometheus release notes to ensure that no incompatible<br>scrape configs are going to break Prometheus after the upgrade.</p>
<h2 id="Creating-an-additional-configuration"><a href="#Creating-an-additional-configuration" class="headerlink" title="Creating an additional configuration"></a>Creating an additional configuration</h2><p>First, you will need to create the additional configuration.<br>Below we are making a simple “prometheus” config.  Name this<br><code>prometheus-additional.yaml</code> or something similar.</p>
<pre><code>- job_name: &quot;prometheus&quot;
  static_configs:
  - targets: [&quot;localhost:9090&quot;]</code></pre>
<p>Then you will need to make a secret out of this configuration.</p>
<pre><code>kubectl create secret generic additional-scrape-configs --from-file=prometheus-additional.yaml --dry-run -oyaml &gt; additional-scrape-configs.yaml</code></pre>
<p>Next, create a new secret using the base64 encoded output as the value for<br><code>prometheus-additional.yaml</code> in the secret.</p>
<pre><code>apiVersion: v1
data:
  prometheus-additional.yaml: LSBqb2JfbmFtZTogInByb21ldGhldXMiCiAgc3RhdGljX2NvbmZpZ3M6CiAgLSB0YXJnZXRzOiBbImxvY2FsaG9zdDo5MDkwIl0K
kind: Secret
metadata:
  creationTimestamp: null
  name: additional-scrape-configs</code></pre>
<p>Finally, reference this additional configuration in your <code>prometheus.yaml</code> CRD.</p>
<pre><code>apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  name: prometheus
  labels:
    prometheus: prometheus
spec:
  replicas: 2
  serviceAccountName: prometheus
  serviceMonitorSelector:
    matchLabels:
      team: frontend
  additionalScrapeConfigs:
    name: additional-scrape-configs
    key: prometheus-additional.yaml
...</code></pre>
<p>NOTE: Use only one secret for ALL additional scrape configurations.</p>
<h2 id="Additional-References"><a href="#Additional-References" class="headerlink" title="Additional References"></a>Additional References</h2><ul>
<li><a href="https://github.com/coreos/prometheus-operator/blob/master/Documentation/api.md#prometheusspec">Prometheus Spec</a></li>
<li><a href="https://github.com/coreos/prometheus-operator/tree/master/example/additional-scrape-configs">Additional Scrape Configs</a></li>
</ul>
